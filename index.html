<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Discover your Mortality Type - Mortals</title>
    
    <!-- Google Fonts - Solway -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Solway:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
<!-- Firebase SDK -->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    
    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAvcg2qMytGsdjtSR3TJNvB2co1_elmmuk",
        authDomain: "mortality-attitude-profile.firebaseapp.com",
        databaseURL: "https://mortality-attitude-profile-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "mortality-attitude-profile",
        storageBucket: "mortality-attitude-profile.firebasestorage.app",
        messagingSenderId: "533303225736",
        appId: "1:533303225736:web:6b0dc8f17fe95dd5659e3d",
        measurementId: "G-VDVS16QL7Q"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    
    // Make database available globally
    window.firebaseDB = database;
    window.firebaseRef = ref;
    window.firebasePush = push;
    window.firebaseOnValue = onValue;
    window.firebaseSet = set;
</script>
    
<style>
    /* CSS Variables for Brand Colors */
    :root {
        --orange-accent: #FF6B35;
        --blue-accent: #004E89;
        --primary-white: #FFF7F3;
        --primary-orange: #F7C59F;
        --text-dark: #004E89;
        --gray-light: #E0E0E0;
        --gray-medium: #999;
        --bright-orange: #FF8C42;
    }
    
    /* Reset and Base Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Solway', serif;
        background-color: var(--primary-white);
        color: var(--text-dark);
        overflow-x: hidden;
        min-height: 100vh;
    }
    
    /* Container for all screens */
    .app-container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    
    /* Screen Styles */
    .screen {
        position: absolute;
        width: 100%;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transform: translateY(100vh);
        transition: opacity 0.5s ease, transform 0.5s ease;
        padding: 20px 0;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .screen.active {
        opacity: 1;
        transform: translateY(0);
    }
    
    .screen.exit {
        opacity: 0;
        transform: translateY(-100vh);
    }
    
    /* Landing Screen Specific */
    #landingScreen {
        min-height: 100vh;
        height: 100vh;
        overflow: hidden;
    }
    
    #landingScreen .content {
        padding-top: 40px;
        padding-bottom: 100px;
    }
    
    /* Content Container */
    .content {
        width: 90%;
        max-width: 800px;
        text-align: center;
        padding: 20px;
    }
    
    /* Typography */
    h1 {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 1.5rem;
        line-height: 1.2;
    }
    
    h2 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 1rem;
        line-height: 1.3;
    }
    
    h3 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--orange-accent);
    }
    
    p {
        font-size: 1.2rem;
        font-weight: 300;
        line-height: 1.6;
        margin-bottom: 2rem;
        color: var(--gray-medium);
    }
    
    /* Landing Image */
    .landing-image {
        width: 200px;
        height: 200px;
        margin: 0 auto 1.5rem auto;
        display: block;
        object-fit: contain;
    }
    
    /* Button Styles */
    .btn {
        background: var(--orange-accent);
        color: white;
        border: none;
        padding: 18px 40px;
        font-size: 1.1rem;
        font-weight: 500;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Solway', serif;
        margin: 10px;
        position: relative;
        z-index: 50;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
    }
    
    .btn:hover {
        background: #ff5722;
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(255, 107, 53, 0.3);
    }
    
    .btn:active {
        transform: translateY(0);
    }
    
    .btn-secondary {
        background: transparent;
        color: var(--orange-accent);
        border: 2px solid var(--orange-accent);
    }
    
    .btn-secondary:hover {
        background: var(--orange-accent);
        color: white;
    }
    
    /* Death Experience Screen Styles */
    .btn-option {
        background: white;
        color: var(--text-dark);
        border: 2px solid var(--gray-light);
        padding: 12px 30px;
        font-size: 1rem;
        font-weight: 500;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Solway', serif;
    }
    
    .btn-option:hover {
        border-color: var(--orange-accent);
        transform: translateY(-2px);
    }
    
    .btn-option.selected {
        background: var(--orange-accent);
        color: white;
        border-color: var(--orange-accent);
    }
    
    /* Form Styles */
    .form-group {
        margin-bottom: 2rem;
        text-align: left;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }
    
    .form-group input,
    .form-group select {
        width: 100%;
        padding: 12px 16px;
        font-size: 1rem;
        border: 2px solid var(--gray-light);
        border-radius: 8px;
        background: white;
        font-family: 'Solway', serif;
        color: var(--text-dark);
    }
    
    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: var(--orange-accent);
    }
    
    .form-group + .form-group {
        margin-top: 2.5rem;
    }
    
    /* Death Experience Screen Layout */
    #deathExperienceScreen .content {
        height: auto;
        max-height: 90vh;
        overflow-y: auto;
        padding: 40px 20px;
    }
    
    #deathExperienceScreen .form-group label {
        text-align: center;
        font-size: 1.1rem;
        margin-bottom: 1rem;
    }
    
    /* Intro Screens */
    #intro1Screen .content,
    #intro2Screen .content,
    #intro3Screen .content {
        padding: 20px;
        max-height: 100vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    /* Brand Footer */
    .brand-footer {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        pointer-events: none;
    }
    
    .logo {
        width: 50px;
        height: 50px;
        pointer-events: auto;
    }
    
    .logo img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
    
    /* Progress Bar */
    .progress-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(255, 247, 243, 0.95);
        padding: 20px;
        z-index: 50;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .progress-container.show {
        opacity: 1;
    }
    
    .progress-text {
        text-align: center;
        font-size: 14px;
        color: var(--gray-medium);
        margin-bottom: 10px;
    }
    
    .progress-bar {
        width: 100%;
        height: 4px;
        background: var(--gray-light);
        border-radius: 2px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: var(--orange-accent);
        width: 0%;
        transition: width 0.3s ease;
    }
    
    /* Question Screen */
    .question-wrapper {
        position: relative;
        overflow: hidden;
        min-height: 400px;
    }
    
    .question-slide {
        position: absolute;
        width: 100%;
        opacity: 0;
        transform: translateY(50px);
        transition: all 0.5s ease;
    }
    
    .question-slide.active {
        opacity: 1;
        transform: translateY(0);
    }
    
    .question-slide.exit-up {
        opacity: 0;
        transform: translateY(-50px);
    }
    
    .question-text {
        font-size: 1.5rem;
        font-weight: 400;
        margin-bottom: 3rem;
        line-height: 1.4;
        min-height: 3em;
    }
    
    /* Likert Scale */
    .likert-container {
        max-width: 700px;
        margin: 0 auto;
    }
    
    .likert-scale {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-bottom: 3rem;
    }
    
    .likert-label {
        font-size: 0.9rem;
        color: var(--gray-medium);
        font-weight: 400;
        white-space: nowrap;
    }
    
    .likert-options {
        display: flex;
        gap: 15px;
        padding: 0 20px;
    }
    
    .likert-option {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 2px solid var(--gray-light);
        background: white;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 500;
    }
    
    .likert-option:hover {
        border-color: var(--orange-accent);
        transform: scale(1.1);
    }
    
    .likert-option.selected {
        background: var(--orange-accent);
        border-color: var(--orange-accent);
        color: white;
    }
    
    /* Checkbox styling */
    .checkbox-group {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin-top: 1rem;
    }
    
    .checkbox-group input[type="checkbox"] {
        width: auto;
        margin-top: 5px;
        cursor: pointer;
    }
    
    .checkbox-group label {
        font-size: 0.9rem;
        line-height: 1.4;
        cursor: pointer;
        text-align: left;
    }
    
    /* Next Button */
    .next-btn {
        margin-top: 2rem;
        opacity: 0.5;
        pointer-events: none;
    }
    
    .next-btn.enabled {
        opacity: 1;
        pointer-events: auto;
    }
    
    /* Results Screen */
    .results-container {
        padding: 3rem;
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0, 78, 137, 0.1);
        max-width: 700px;
        margin: 0 auto;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .results-container.has-image {
        padding-top: 0;
    }
    
    .archetype-image {
        width: calc(100% + 6rem);
        margin: -3rem -3rem 2rem -3rem;
        height: 300px;
        object-fit: cover;
        border-radius: 20px 20px 0 0;
    }
    
    .archetype-result {
        margin-bottom: 3rem;
    }
    
    .archetype-result h3 {
        color: var(--blue-accent);
        font-weight: 400;
        margin-bottom: 0.5rem;
    }
    
    .archetype-result h2 {
        color: var(--text-dark);
        margin-bottom: 1rem;
    }
    
    .archetype-result p {
        color: var(--text-dark);
        font-size: 1.1rem;
        font-weight: 700;
    }
    
    /* Modern Scores Section */
    .scores-section {
        margin: 3rem 0;
    }
    
    .scores-title {
        font-size: 1.3em;
        font-weight: 400;
        color: var(--blue-accent);
        margin-bottom: 30px;
        text-align: center;
    }
    
    .score-row {
        display: grid;
        grid-template-columns: 100px 70px auto 80px;
        align-items: center;
        gap: 25px;
        padding: 18px 0;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .score-row:last-child {
        border-bottom: none;
    }
    
    .score-category {
        font-size: 0.95em;
        font-weight: 600;
        color: #4a5568;
    }
    
    .score-emoji {
        font-size: 1.8em;
        text-align: center;
    }
    
    .score-status {
        display: flex;
        flex-direction: column;
        gap: 2px;
        text-align: left;
    }
    
    .score-label {
        font-size: 1.1em;
        font-weight: 600;
        color: var(--text-dark);
        text-align: left;
    }
    
    .score-description {
        font-size: 0.85em;
        color: #718096;
        text-align: left;
    }
    
    .score-value {
        font-size: 0.9em;
        text-align: right;
        font-weight: 500;
    }
    
    /* Color coding for score values */
    .score-high { color: #22c55e; }
    .score-good { color: #3b82f6; }
    .score-moderate { color: var(--bright-orange); }
    .score-problem { color: #ef4444; }
    
    /* Feedback Section */
    .feedback-section {
        margin-top: 3rem;
        padding: 2rem;
        background: #f8f9fa;
        border-radius: 15px;
        text-align: center;
    }
    
    .feedback-section h3 {
        color: var(--text-dark);
        margin-bottom: 1.5rem;
        font-size: 1.2rem;
        font-weight: 600;
    }
    
    .feedback-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-bottom: 2rem;
    }
    
    .feedback-btn {
        background: white;
        color: var(--text-dark);
        border: 2px solid var(--gray-light);
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Solway', serif;
    }
    
    .feedback-btn:hover:not(:disabled) {
        border-color: var(--orange-accent);
        transform: translateY(-2px);
    }
    
    .feedback-btn:disabled {
        cursor: not-allowed;
    }
    
    #additionalFeedback {
        width: 100%;
        max-width: 400px;
        padding: 12px 16px;
        font-size: 1rem;
        border: 2px solid var(--gray-light);
        border-radius: 8px;
        background: white;
        font-family: 'Solway', serif;
        color: var(--text-dark);
        margin-bottom: 1rem;
        resize: vertical;
        min-height: 80px;
    }
    
    #additionalFeedback:focus {
        outline: none;
        border-color: var(--orange-accent);
    }
    
    #additionalFeedback::placeholder {
        color: var(--gray-medium);
    }
    
    /* Email Modal */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }
    
    .modal.show {
        display: flex;
    }
    
    .modal-content {
        background: white;
        padding: 3rem;
        border-radius: 20px;
        max-width: 500px;
        width: 90%;
        text-align: center;
        position: relative;
    }
    
    .close-modal {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 30px;
        cursor: pointer;
        color: var(--gray-medium);
        background: none;
        border: none;
    }
    
    .close-modal:hover {
        color: var(--text-dark);
    }
    
    .gdpr-text {
        font-size: 0.85rem;
        color: var(--gray-medium);
        text-align: left;
        margin-top: 1rem;
        line-height: 1.4;
    }
    
    /* Loading State */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255,255,255,.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* Success Message */
    .success-message {
        background: #4CAF50;
        color: white;
        padding: 1rem;
        border-radius: 8px;
        margin-top: 1rem;
        display: none;
    }
    
    .success-message.show {
        display: block;
    }
    
    /* Status Message */
    .status-message {
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 1rem 2rem;
        border-radius: 30px;
        font-size: 0.9rem;
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 200;
    }
    
    .status-message.show {
        opacity: 1;
    }
    
    /* MOBILE STYLES - ALL IN ONE PLACE */
    @media (max-width: 768px) {
/* MOBILE STYLES - SIMPLIFIED AND FIXED */
@media (max-width: 768px) {
    /* Base mobile setup */
    body {
        overflow-y: auto;
        overflow-x: hidden;
    }
    
    /* Screens should be scrollable */
    .screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding: 20px;
    }
    
    /* Content container */
    .content {
        width: 100%;
        max-width: 100%;
        padding: 20px;
        margin-bottom: 100px;
    }
    
    /* Landing screen specific */
    #landingScreen {
        display: flex;
        align-items: flex-start;
        padding-top: 40px;
    }
    
    /* Landing image - smaller on mobile */
    .landing-image {
        width: 120px !important;
        height: 120px !important;
        margin: 0 auto 20px auto !important;
        display: block !important;
    }
    
    /* Typography for mobile */
    h1 {
        font-size: 1.8rem;
        margin-bottom: 1rem;
    }
    
    h2 {
        font-size: 1.4rem;
    }
    
    p {
        font-size: 0.95rem;
        line-height: 1.5;
        margin-bottom: 1.5rem;
    }
    
    /* Buttons - simple and working */
    .btn {
        display: block;
        width: 80%;
        max-width: 250px;
        margin: 20px auto;
        padding: 15px 30px;
        font-size: 1rem;
        position: relative;
        z-index: 100;
    }
    
    /* Footer at bottom */
    .brand-footer {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1;
    }
    
    .logo {
        width: 40px;
        height: 40px;
    }
    
    /* Other mobile adjustments */
    .question-text {
        font-size: 1.1rem;
    }
    
    .likert-option {
        width: 38px;
        height: 38px;
    }
    
    .results-container {
        padding: 1.5rem;
    }
}
    
    /* Extra small screens */
    @media (max-width: 380px) {
        .landing-image,
        #landingScreen img {
            width: 120px !important;
            height: 120px !important;
        }
        
        #landingScreen h1 {
            font-size: 1.5rem;
        }
        
        #landingScreen p {
            font-size: 0.85rem;
        }
    }
    
    /* iOS Safari specific fixes */
    @supports (-webkit-touch-callout: none) {
        .btn {
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .screen {
            -webkit-transform: translate3d(0,0,0);
        }
    }

/* Ensure no overlay blocks the button */
#landingScreen * {
    pointer-events: auto;
}

#landingScreen .brand-footer,
#landingScreen .brand-footer * {
    pointer-events: none !important;
}
        
</style>
</head>
<body>
    <!-- Status Message -->
    <div class="status-message" id="statusMessage"></div>
    
    <!-- Brand Footer -->
    <div class="brand-footer">
        <div class="logo">
            <img src="mortals-logo.png" alt="Mortals Logo">
        </div>
    </div>
    
    <!-- Progress Bar -->
    <div class="progress-container" id="progressContainer">
        <div class="progress-text" id="progressText">Question 1 of 36</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>
    
    <!-- Updated Landing Screen with image -->
<div class="screen active" id="landingScreen">
    <div class="content">
        <img src="map-landing.png" alt="MAP" class="landing-image">
        <h1>Discover what really drives you</h1>
        <p>Death is the one experience we all share, yet each of us relates to it differently. Some of us are driven to create lasting legacies. Others find peace in acceptance. Many experience fear, while some simply disengage from the topic entirely.</p>
        <button class="btn" onclick="startAssessment()" ontouchend="startAssessment(); event.preventDefault();">What drives you?</button>
    </div>
</div>

<!-- Intro Screen 1 -->
<div class="screen" id="intro1Screen">
    <div class="content">
        <h2 style="font-size: 2.5rem; margin-bottom: 2rem;">How do you relate to life's biggest certainty?</h2>
        
        <div style="max-width: 700px; margin: 0 auto; text-align: left;">
            <p style="color: var(--text-dark); font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
                The Mortality Attitude Profile (MAP) is a research-based quiz that helps you understand your unique relationship with mortality. Through 36 carefully crafted questions, you'll discover which of seven distinct "mortality types" best describes how you engage with life's finite nature.
            </p>
            
            <p style="color: var(--text-dark); font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                This isn't about being morbid or pessimistic – it's about self-awareness. Understanding how you relate to mortality can unlock insights about what drives you, what holds you back, and what truly matters in your life.
            </p>
        </div>
        
        <button class="btn" onclick="showScreen('intro2')">Next →</button>
    </div>
</div>

<!-- Intro Screen 2 -->
<div class="screen" id="intro2Screen">
    <div class="content">
        <h2 style="font-size: 2.5rem; margin-bottom: 2rem;">Built on peer-reviewed research</h2>
        
        <div style="max-width: 700px; margin: 0 auto; text-align: left;">
            <p style="color: var(--text-dark); font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
                The MAP is based on the research developed by psychologists. This framework emerged from studying hundreds of people across diverse backgrounds.
            </p>
            
            <p style="color: var(--text-dark); font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
                The research identified five key dimensions of mortality awareness:
            </p>
            
            <ul style="list-style: none; padding: 0; margin-bottom: 2rem;">
                <li style="margin-bottom: 1rem; padding-left: 30px; position: relative;">
                    <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                    <strong style="color: var(--text-dark);">Legacy</strong> - The drive to create something lasting
                </li>
                <li style="margin-bottom: 1rem; padding-left: 30px; position: relative;">
                    <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                    <strong style="color: var(--text-dark);">Fear</strong> - Anxiety about death and dying
                </li>
                <li style="margin-bottom: 1rem; padding-left: 30px; position: relative;">
                    <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                    <strong style="color: var(--text-dark);">Acceptance</strong> - Integration of mortality into your worldview
                </li>
                <li style="margin-bottom: 1rem; padding-left: 30px; position: relative;">
                    <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                    <strong style="color: var(--text-dark);">Disempowerment</strong> - Feelings of helplessness against mortality
                </li>
                <li style="margin-bottom: 1rem; padding-left: 30px; position: relative;">
                    <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                    <strong style="color: var(--text-dark);">Disengagement</strong> - Avoidance of death-related thoughts
                </li>
            </ul>
            
            <p style="color: var(--text-dark); font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                Your unique pattern across these dimensions determines your mortality type – one of seven types that capture different ways people navigate their awareness of death.
            </p>
        </div>
        
        <button class="btn" onclick="showScreen('intro3')">Next →</button>
    </div>
</div>

<!-- Intro Screen 3 -->
<div class="screen" id="intro3Screen">
    <div class="content">
        <h2 style="font-size: 2.5rem; margin-bottom: 2rem;">Your personalised mortality type</h2>
        
        <div style="max-width: 700px; margin: 0 auto; text-align: left;">
            <p style="color: var(--text-dark); font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
                In the next 5-7 minutes, you'll answer questions about your thoughts, feelings, and attitudes toward mortality. There are no right or wrong answers – only honest reflections of your personal experience.
            </p>
            
            <p style="color: var(--text-dark); font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
                After completing the assessment, you'll receive:
            </p>
            
            <ul style="list-style: none; padding: 0; margin-bottom: 2rem;">
                <li style="margin-bottom: 1rem; padding-left: 30px; position: relative;">
                    <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                    <strong style="color: var(--text-dark);">Your Mortality Type</strong> - One of seven evidence-based types that best matches your score
                </li>
                <li style="margin-bottom: 1rem; padding-left: 30px; position: relative;">
                    <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                    <strong style="color: var(--text-dark);">Your Dimension Scores</strong> - How you score on each of the five core dimensions
                </li>
                <li style="margin-bottom: 1rem; padding-left: 30px; position: relative;">
                    <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                    <strong style="color: var(--text-dark);">Full Analysis</strong> (via email) - Detailed interpretation to support your growth in life
                </li>
            </ul>
            
            <p style="color: var(--text-dark); font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                Remember: This tool is for self-reflection and understanding. Your results can offer valuable insights, but they're just one perspective on a deeply personal aspect of human experience.
            </p>
            
            <p style="color: var(--text-dark); font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                Ready to begin?
            </p>
        </div>
        
        <button class="btn" onclick="showScreen('demographics')">Let's go →</button>
    </div>
</div>
        
        <!-- Demographics Screen -->
        <div class="screen" id="demographicsScreen">
            <div class="content">
                <h2>Tell us a bit about yourself</h2>
                <p>This helps us understand patterns across different groups</p>
                
                <div class="form-group">
                    <label for="ageRange">Age range</label>
                    <select id="ageRange" onchange="checkDemographics()">
                        <option value="">Select your age range</option>
                        <option value="18-24">18-24</option>
                        <option value="25-34">25-34</option>
                        <option value="35-44">35-44</option>
                        <option value="45-54">45-54</option>
                        <option value="55-64">55-64</option>
                        <option value="65+">65+</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="sex">Sex</label>
                    <select id="sex" onchange="checkDemographics()">
                        <option value="">Select an option</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                        <option value="prefer-not">Prefer not to say</option>
                    </select>
                </div>
                
                <button class="btn next-btn" id="demographicsNext" onclick="startQuestions()">Continue</button>
            </div>
        </div>

        <!-- Death Experience Screen -->
        <div class="screen" id="deathExperienceScreen">
            <div class="content">
                <h2>Life Experiences</h2>
                <p>Understanding your past experiences helps us provide more personalized insights</p>
                
                <!-- Question 1: Life threatening illness -->
                <div class="form-group">
                    <label>Have you ever had a life threatening illness?</label>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                        <button class="btn-option" id="illness-yes" onclick="setDeathExperience('illness', true)">Yes</button>
                        <button class="btn-option" id="illness-no" onclick="setDeathExperience('illness', false)">No</button>
                    </div>
                </div>
                
                <!-- Question 2: Close to someone with illness -->
                <div class="form-group">
                    <label>Have you ever been emotionally close to someone who has had a life threatening illness?</label>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                        <button class="btn-option" id="closeIllness-yes" onclick="setDeathExperience('closeIllness', true)">Yes</button>
                        <button class="btn-option" id="closeIllness-no" onclick="setDeathExperience('closeIllness', false)">No</button>
                    </div>
                </div>
                
                <!-- Follow-up: How close (only shown if yes) -->
                <div class="form-group" id="closeIllnessScale" style="display: none;">
                    <label>How emotionally close were you to that person during their illness?</label>
                    <div class="likert-scale" style="margin-top: 20px;">
                        <span class="likert-label">Not close<br>at all</span>
                        <div class="likert-options">
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 1)">1</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 2)">2</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 3)">3</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 4)">4</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 5)">5</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 6)">6</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 7)">7</button>
                        </div>
                        <span class="likert-label">Extremely<br>close</span>
                    </div>
                </div>
                
                <!-- Question 3: Close to dying -->
                <div class="form-group">
                    <label>Have you ever been close to dying?</label>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                        <button class="btn-option" id="closeDying-yes" onclick="setDeathExperience('closeDying', true)">Yes</button>
                        <button class="btn-option" id="closeDying-no" onclick="setDeathExperience('closeDying', false)">No</button>
                    </div>
                </div>
                
                <!-- Follow-up: How close to death -->
                <div class="form-group" id="closeDyingScale" style="display: none;">
                    <label>How close to death did you come?</label>
                    <div class="likert-scale" style="margin-top: 20px;">
                        <span class="likert-label">Not very<br>close</span>
                        <div class="likert-options">
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 1)">1</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 2)">2</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 3)">3</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 4)">4</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 5)">5</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 6)">6</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 7)">7</button>
                        </div>
                        <span class="likert-label">Extremely<br>close</span>
                    </div>
                </div>
                
                <!-- Question 4: Seen someone die -->
                <div class="form-group">
                    <label>Have you ever seen someone die?</label>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                        <button class="btn-option" id="seenDie-yes" onclick="setDeathExperience('seenDie', true)">Yes</button>
                        <button class="btn-option" id="seenDie-no" onclick="setDeathExperience('seenDie', false)">No</button>
                    </div>
                </div>
                
                <button class="btn next-btn" id="deathExperienceNext" onclick="startQuestions()">Continue</button>
            </div>
        </div>
        
        <!-- Question Screen -->
        <div class="screen" id="questionScreen">
            <div class="content">
                <div class="question-wrapper">
                    <div class="question-slide active" id="questionSlide">
                        <h2 class="question-text" id="questionText">Question text will appear here</h2>
                        
                        <div class="likert-container">
                            <div class="likert-scale">
                                <span class="likert-label">Strongly<br>Disagree</span>
                                <div class="likert-options" id="likertOptions">
                                    <button class="likert-option" data-value="1" onclick="selectOption(1)">1</button>
                                    <button class="likert-option" data-value="2" onclick="selectOption(2)">2</button>
                                    <button class="likert-option" data-value="3" onclick="selectOption(3)">3</button>
                                    <button class="likert-option" data-value="4" onclick="selectOption(4)">4</button>
                                    <button class="likert-option" data-value="5" onclick="selectOption(5)">5</button>
                                    <button class="likert-option" data-value="6" onclick="selectOption(6)">6</button>
                                    <button class="likert-option" data-value="7" onclick="selectOption(7)">7</button>
                                </div>
                                <span class="likert-label">Strongly<br>Agree</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div class="screen" id="resultsScreen">
            <div class="content">
                <div class="results-container has-image">
                    <img id="archetypeImage" class="archetype-image" src="" alt="Archetype illustration">
                    <div class="archetype-result">
                        <h3>Your mortality type</h3>
                        <h2 id="archetypeName">Your Archetype</h2>
                        <p id="archetypeDescription">Description will appear here</p>
                    </div>
                    
                    <div class="scores-section">
                        <h2 class="scores-title">Your type explained</h2>
                        <div id="scoresContainer">
                            <!-- Score rows will be dynamically inserted here -->
                        </div>
                    </div>

<!-- Add to results section -->
<div class="feedback-section">
    <h3>What do you think?</h3>
    <div class="feedback-buttons">
        <button class="feedback-btn" onclick="submitFeedback('easy')">Easy to use</button>
        <button class="feedback-btn" onclick="submitFeedback('confusing')">Confusing</button>
        <button class="feedback-btn" onclick="submitFeedback('accurate')">Results feel accurate</button>
        <button class="feedback-btn" onclick="submitFeedback('inaccurate')">Results don't fit me</button>
        <button class="feedback-btn" onclick="submitFeedback('too-long')">Too long</button>
        <button class="feedback-btn" onclick="submitFeedback('just-right')">Perfect length</button>
    </div>
    <textarea id="additionalFeedback" placeholder="Any other thoughts? (optional)" maxlength="500"></textarea>
    <button class="btn-secondary" onclick="submitDetailedFeedback()">Send Feedback</button>
</div>
                    
                    <div class="button-group">
                        <button class="btn" onclick="showEmailModal()">Email my full results</button>
                        <button class="btn btn-secondary" onclick="startOver()">Take again</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Email Modal -->
    <div class="modal" id="emailModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeEmailModal()">&times;</button>
            <h2>Get your full results</h2>
            <p>Enter your details to receive an analysis of your mortality type and subscale scores.</p>
            
            <div class="form-group">
                <label for="firstName">First name</label>
                <input type="text" id="firstName" placeholder="Enter your first name">
            </div>
            
            <div class="form-group">
                <label for="email">Email address</label>
                <input type="email" id="email" placeholder="Enter your email">
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="emailConsent" checked>
                <label for="emailConsent">
                    I agree to receive occasional updates about mortality research and the Mortals community. I can unsubscribe at any time.
                </label>
            </div>
            
            <p class="gdpr-text">
                Your data will be used for research purposes and to send you your results. We take your privacy seriously and will never sell or share your personal information with third parties.
            </p>
            
            <button class="btn" id="sendEmailBtn" onclick="sendEmail()">Send results</button>
            
            <div class="success-message" id="successMessage">
                Results sent successfully! Check your email.
            </div>
        </div>
    </div>
    
    <script>
        // Debug code - add this FIRST in your script
window.addEventListener('load', function() {
    // Check if function exists
    if (typeof startAssessment === 'function') {
        alert('startAssessment exists');
    } else {
        alert('startAssessment NOT found');
    }
    
    // Find the button
    const btn = document.querySelector('#landingScreen .btn');
    if (btn) {
        alert('Button found: ' + btn.textContent);
        
        // Add a direct listener
        btn.addEventListener('click', function(e) {
            alert('Button clicked via listener');
            startAssessment();
        });
    } else {
        alert('Button NOT found');
    }
});

// Also log any errors
window.addEventListener('error', function(e) {
    alert('Error: ' + e.message);
});
// Make function available immediately
function startAssessment() {
    console.log('Starting assessment...');
    
    // Just hide landing and show intro1 directly
    document.getElementById('landingScreen').classList.remove('active');
    document.getElementById('intro1Screen').classList.add('active');
    
    // Set up the app state
    appState = {
        currentScreen: 'intro1',
        currentQuestion: 0,
        responses: [],
        demographics: {},
        deathExperiences: {
            illness: null,
            closeIllness: null,
            closeIllnessLevel: null,
            closeDying: null,
            closeDyingLevel: null,
            seenDie: null
        },
        selectedOption: null,
        results: null,
        sessionId: 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)
    };
}
        // MMAMM Core Logic (unchanged from original)
        const MMAMM = {
            questions: [
                { id: 1, text: "It makes me angry when I think about my own death", subscale: "FEAR" },
                { id: 2, text: "I have seen someone that almost died and it made me realise that I am very scared of dying", subscale: "FEAR" },
                { id: 3, text: "I am aware that death is part of life", subscale: "ACC" },
                { id: 4, text: "I think of death as something that is far away and that will not happen to me", subscale: "Diseng" },
                { id: 5, text: "I want to be remembered for doing great things for the world when I am no longer alive", subscale: "LEG" },
                { id: 6, text: "My values are very important to me because this is all that will be remembered from me when I will be dead", subscale: "LEG" },
                { id: 7, text: "We will all die at some point", subscale: "ACC" },
                { id: 8, text: "I only think of the present moment and do not worry about my own death", subscale: "Diseng" },
                { id: 9, text: "If I had an untreatable illness I would not fight it as we are helpless anyway", subscale: "Disemp" },
                { id: 10, text: "I would like to create something that will outlive me", subscale: "LEG" },
                { id: 11, text: "I want to do things in an original way so I am valued and feel further away from death", subscale: "LEG" },
                { id: 12, text: "Leaving behind my thoughts and beliefs in writing to others is a good way of beating death", subscale: "LEG" },
                { id: 13, text: "Nothing matters to me because we all die in the end", subscale: "Disemp" },
                { id: 14, text: "I am scared of dying before I am old", subscale: "FEAR" },
                { id: 15, text: "Life is futile", subscale: "Disemp" },
                { id: 16, text: "When I think about the fact that we are only on earth for a short period of time, I feel that I want to create something to leave behind", subscale: "LEG" },
                { id: 17, text: "I fear the death of my close relatives", subscale: "FEAR" },
                { id: 18, text: "I sometimes forget that I will die", subscale: "Diseng" },
                { id: 19, text: "Death makes me feel hopeless", subscale: "Disemp" },
                { id: 20, text: "I do not let the fear of dying rule my life", subscale: "ACC" },
                { id: 21, text: "I want to be remembered after my death for my charity work", subscale: "LEG" },
                { id: 22, text: "The idea of death makes me feel powerless", subscale: "FEAR" },
                { id: 23, text: "I would like to name a charity after my name so it lives on after my death", subscale: "LEG" },
                { id: 24, text: "I think of death as a negative thing", subscale: "FEAR" },
                { id: 25, text: "I accept that there is a cycle of life from birth to death", subscale: "ACC" },
                { id: 26, text: "I never think about what might happen after death", subscale: "Diseng" },
                { id: 27, text: "Thinking about death paralyses me", subscale: "FEAR" },
                { id: 28, text: "When I think about death, it makes me feel that human race is insignificant", subscale: "Disemp" },
                { id: 29, text: "When I think about death, I feel nervous", subscale: "FEAR" },
                { id: 30, text: "By giving time and energy to others unselfishly, I feel stronger than the forces that will end my days", subscale: "LEG" },
                { id: 31, text: "I feel afraid when I think of the time flying rapidly by", subscale: "FEAR" },
                { id: 32, text: "A record of my life (photo film, diaries) after I am no more is important for me so that I am remembered", subscale: "LEG" },
                { id: 33, text: "When thoughts of death enter my mind, I think about something else straight away", subscale: "FEAR" },
                { id: 34, text: "Thinking about death makes me feel that everything is pointless", subscale: "Disemp" },
                { id: 35, text: "I accept that I cannot live forever", subscale: "ACC" },
                { id: 36, text: "Death thoughts are an unnecessary waste of energy", subscale: "Diseng" }
            ],
            
            subscales: {
                LEG: { 
                    name: "Legacy", 
                    items: [5, 10, 11, 16, 21, 23, 30, 6, 32, 12],
                    description: "The need to create a legacy to live on beyond death"
                },
                FEAR: { 
                    name: "Fearfulness", 
                    items: [29, 14, 24, 27, 2, 31, 22, 17, 33, 1],
                    description: "Anxiety attached to the impossibility of escaping the end of one's life"
                },
                ACC: { 
                    name: "Acceptance", 
                    items: [3, 35, 20, 25, 7],
                    description: "Integration of the emotional and physical reality of death"
                },
                Disemp: { 
                    name: "Disempowerment", 
                    items: [34, 9, 13, 15, 19, 28],
                    description: "Realization of personal insignificance and vulnerability in the face of death"
                },
                Diseng: { 
                    name: "Disengagement", 
                    items: [8, 36, 26, 18, 4],
                    description: "Refusal to acknowledge death and a feeling of immortality"
                }
            },
            
            referenceData: {
                LEG: { mean: 4.08, std: 1.22 },
                FEAR: { mean: 3.64, std: 1.09 },
                ACC: { mean: 6.16, std: 0.94 },
                Disemp: { mean: 2.61, std: 1.14 },
                Diseng: { mean: 3.67, std: 1.15 }
            },
            
            archetypes: {
                "The Fearful Visionary": {
                    subscales: ["LEG", "FEAR"],
                    correlation: 0.399,
                    description: "This attitude type is focused on leaving a legacy but is held back by fear and anxiety. You have a vision for the future but struggle to take action to make it a reality."
                },
                "The Legacy Dreamer": {
                    subscales: ["LEG", "Disemp"],
                    correlation: 0.164,
                    description: "This attitude type is focused on leaving a legacy but feels disempowered to take action. You may struggle with feelings of hopelessness or self-doubt but are creative thinkers who can imagine a better future."
                },
                "The Mortality Denier": {
                    subscales: ["FEAR", "ACC"],
                    correlation: -0.267,
                    description: "This attitude type experiences inner conflict between fear and acceptance of mortality. You may oscillate between moments of acceptance and periods of anxiety, creating an ambivalent relationship with life's finite nature."
                },
                "The Mortality Shadow": {
                    subscales: ["FEAR", "Disemp"],
                    correlation: 0.381,
                    description: "This attitude type is consumed by fear and feels powerless to change their situation. You may struggle with depression or other mental health issues and may feel like you are living in a shadow."
                },
                "The Mortality Drifter": {
                    subscales: ["FEAR", "Diseng"],
                    correlation: 0.208,
                    description: "This attitude type is disengaged from thinking about death and experiences fear when they do. Your fear of death makes you feel disconnected from others and prevents you from pursuing their goals, but you may have a creative side that is waiting to be expressed."
                },
                "The Mortality Champion": {
                    subscales: ["ACC", "Disemp"],
                    correlation: -0.238,
                    description: "This attitude type demonstrates resilience in the face of mortality. Despite moments of feeling powerless, you maintain acceptance of life's finite nature, using this acceptance as a source of strength and empowerment."
                },
                "The Legacy Weaver": {
                    subscales: ["LEG", "Diseng"],
                    correlation: 0.039,
                    description: "This attitude type is focused on weaving a lasting legacy that will outlast them. You are engaged in the present and use your time and resources to create something that will make a positive impact on the world."
                }
            },
            
            scoring: {
                calculateRawScores(responses) {
                    const scores = {};
                    
                    for (const [subscaleKey, subscaleData] of Object.entries(MMAMM.subscales)) {
                        const itemScores = subscaleData.items.map(itemNum => responses[itemNum - 1]);
                        scores[subscaleKey] = itemScores.reduce((sum, score) => sum + score, 0) / itemScores.length;
                    }
                    
                    return scores;
                },
                
                standardizeScores(rawScores) {
                    const standardized = {};
                    
                    for (const [subscale, score] of Object.entries(rawScores)) {
                        const { mean, std } = MMAMM.referenceData[subscale];
                        standardized[subscale] = (score - mean) / std;
                    }
                    
                    return standardized;
                },
                
                assignArchetype(standardizedScores) {
                    let bestMatch = null;
                    let bestScore = -Infinity;
                    
                    for (const [archetypeName, archetypeData] of Object.entries(MMAMM.archetypes)) {
                        const [subscale1, subscale2] = archetypeData.subscales;
                        const score1 = standardizedScores[subscale1];
                        const score2 = standardizedScores[subscale2];
                        const correlation = archetypeData.correlation;
                        
                        let matchScore = 0;
                        
                        if (correlation > 0) {
                            matchScore = (score1 + score2) / 2;
                            const similarity = 1 - Math.abs(score1 - score2);
                            matchScore += similarity * Math.abs(correlation);
                        } else {
                            if (Math.abs(score1) < 0.5 && Math.abs(score2) < 0.5) {
                                matchScore = 1 - Math.abs(score1 - score2);
                            } else {
                                matchScore = Math.abs(score1 - score2) * Math.abs(correlation);
                            }
                        }
                        
                        if (matchScore > bestScore) {
                            bestScore = matchScore;
                            bestMatch = {
                                name: archetypeName,
                                description: archetypeData.description,
                                score: matchScore,
                                subscales: [subscale1, subscale2],
                                subscaleScores: [score1, score2]
                            };
                        }
                    }
                    
                    return bestMatch;
                },
                
                processResponses(responses) {
                    const rawScores = this.calculateRawScores(responses);
                    const standardizedScores = this.standardizeScores(rawScores);
                    const archetype = this.assignArchetype(standardizedScores);
                    
                    return {
                        rawScores,
                        standardizedScores,
                        archetype
                    };
                }
            }
        };
        
        // Application State
        let appState = {
            currentScreen: 'landing',
            currentQuestion: 0,
            responses: [],
            demographics: {},
            deathExperiences: {
                illness: null,
                closeIllness: null,
                closeIllnessLevel: null,
                closeDying: null,
                closeDyingLevel: null,
                seenDie: null
            },
            selectedOption: null,
            results: null,
            sessionId: null
        };
        
        // Generate unique session ID
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Show status message
        function showStatus(message, duration = 3000) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.classList.add('show');
            
            setTimeout(() => {
                statusEl.classList.remove('show');
            }, duration);
        }
        
        // Screen Navigation
        function showScreen(screenName) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active', 'exit');
            });
            
            setTimeout(() => {
                document.getElementById(screenName + 'Screen').classList.add('active');
            }, 100);
            
            appState.currentScreen = screenName;
        }
        
        // Start Assessment
        function startAssessment() {
            appState = {
                currentScreen: 'intro1',
                currentQuestion: 0,
                responses: [],
                demographics: {},
                deathExperiences: {
                    illness: null,
                    closeIllness: null,
                    closeIllnessLevel: null,
                    closeDying: null,
                    closeDyingLevel: null,
                    seenDie: null
                },
                selectedOption: null,
                results: null,
                sessionId: generateSessionId()
            };
            showScreen('intro1');
        }
        
        // Check Demographics
        function checkDemographics() {
            const age = document.getElementById('ageRange').value;
            const sex = document.getElementById('sex').value;
            const nextBtn = document.getElementById('demographicsNext');
            
            if (age && sex) {
                nextBtn.classList.add('enabled');
                appState.demographics = { age, sex };
            } else {
                nextBtn.classList.remove('enabled');
            }
        }

        // Start Questions
        function startQuestions() {
            // Check which screen we're coming from
            if (appState.currentScreen === 'demographics') {
                // Coming from demographics, go to death experience
                if (!appState.demographics.age || !appState.demographics.sex) return;
                
                showScreen('deathExperience');
                return;
            }
            
            // Coming from death experience, check if complete
            const de = appState.deathExperiences;
            if (de.illness === null || de.closeIllness === null || de.closeDying === null || de.seenDie === null) {
                return;
            }
            
            // Start the actual questions
            appState.currentQuestion = 0;
            appState.responses = [];
            appState.selectedOption = null;
            
            showScreen('question');
            document.getElementById('progressContainer').classList.add('show');
            displayQuestion();
        }
        
        // Death Experience Functions
        function setDeathExperience(question, value) {
            appState.deathExperiences[question] = value;
            
            // Update button states
            document.getElementById(`${question}-yes`).classList.toggle('selected', value === true);
            document.getElementById(`${question}-no`).classList.toggle('selected', value === false);
            
            // Show/hide follow-up scales
            if (question === 'closeIllness') {
                document.getElementById('closeIllnessScale').style.display = value ? 'block' : 'none';
                if (!value) {
                    appState.deathExperiences.closeIllnessLevel = null;
                    document.querySelectorAll('#closeIllnessScale .likert-option').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                }
            }
            
            if (question === 'closeDying') {
                document.getElementById('closeDyingScale').style.display = value ? 'block' : 'none';
                if (!value) {
                    appState.deathExperiences.closeDyingLevel = null;
                    document.querySelectorAll('#closeDyingScale .likert-option').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                }
            }
            
            checkDeathExperienceCompletion();
        }

        function setDeathExperienceScale(scale, value) {
            appState.deathExperiences[scale] = value;
            
            // Update button states
            const container = scale === 'closeIllnessLevel' ? 'closeIllnessScale' : 'closeDyingScale';
            document.querySelectorAll(`#${container} .likert-option`).forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`#${container} .likert-option:nth-child(${value})`).classList.add('selected');
            
            checkDeathExperienceCompletion();
        }

        function checkDeathExperienceCompletion() {
            const de = appState.deathExperiences;
            let isComplete = true;
            
            // Check all required fields
            if (de.illness === null || de.closeIllness === null || de.closeDying === null || de.seenDie === null) {
                isComplete = false;
            }
            
            // Check follow-up questions if needed
            if (de.closeIllness === true && de.closeIllnessLevel === null) {
                isComplete = false;
            }
            if (de.closeDying === true && de.closeDyingLevel === null) {
                isComplete = false;
            }
            
            // Enable/disable continue button
            const nextBtn = document.getElementById('deathExperienceNext');
            if (isComplete) {
                nextBtn.classList.add('enabled');
            } else {
                nextBtn.classList.remove('enabled');
            }
        }
        
        // Display Current Question
        function displayQuestion() {
            const question = MMAMM.questions[appState.currentQuestion];
            document.getElementById('questionText').textContent = question.text;
            
            const progress = ((appState.currentQuestion + 1) / MMAMM.questions.length) * 100;
            document.getElementById('progressText').textContent = `Question ${appState.currentQuestion + 1} of ${MMAMM.questions.length}`;
            document.getElementById('progressFill').style.width = progress + '%';
            
            document.querySelectorAll('.likert-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            if (appState.responses[appState.currentQuestion]) {
                const prevValue = appState.responses[appState.currentQuestion];
                document.querySelector(`[data-value="${prevValue}"]`).classList.add('selected');
                appState.selectedOption = prevValue;
            } else {
                appState.selectedOption = null;
            }
        }
        
        // Select Option
        function selectOption(value) {
            document.querySelectorAll('.likert-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`[data-value="${value}"]`).classList.add('selected');
            
            appState.selectedOption = value;
            appState.responses[appState.currentQuestion] = value;
            
            setTimeout(() => {
                nextQuestion();
            }, 300);
        }
        
        // Next Question
        function nextQuestion() {
            const questionSlide = document.getElementById('questionSlide');
            
            if (appState.currentQuestion < MMAMM.questions.length - 1) {
                questionSlide.classList.remove('active');
                questionSlide.classList.add('exit-up');
                
                setTimeout(() => {
                    appState.currentQuestion++;
                    displayQuestion();
                    
                    questionSlide.classList.remove('exit-up');
                    questionSlide.classList.add('active');
                }, 500);
            } else {
                calculateResults();
            }
        }
        
        // Save data to Firebase
        async function saveToFirebase(data) {
            try {
                if (!window.firebaseDB) {
                    console.error('Firebase not initialized');
                    return false;
                }
                
                const responsesRef = window.firebaseRef(window.firebaseDB, 'responses');
                await window.firebasePush(responsesRef, data);
                console.log('Data saved to Firebase successfully');
                return true;
            } catch (error) {
                console.error('Error saving to Firebase:', error);
                return false;
            }
        }
        
        // Get score interpretation with emoji
        function getScoreInterpretation(subscale, rawScore) {
            const mean = MMAMM.referenceData[subscale].mean;
            const std = MMAMM.referenceData[subscale].std;
            const zScore = (rawScore - mean) / std;
            
            // Determine if this subscale is "good when high" or "good when low"
            const isGoodWhenHigh = (subscale === 'LEG' || subscale === 'ACC');
            
            let emoji, label, description, colorClass;
            
            if (isGoodWhenHigh) {
                // Legacy and Acceptance: higher is better
                if (zScore > 1) {
                    emoji = '🤩';
                    label = subscale === 'LEG' ? 'Deeply Legacy-Focused' : 'Deeply Integrated';
                    description = subscale === 'LEG' ? 'Strong drive to create lasting impact' : 'Profound emotional integration of mortality';
                    colorClass = 'score-high';
                } else if (zScore > 0.5) {
                    emoji = '🤩';
                    label = subscale === 'LEG' ? 'Legacy-Driven' : 'Well-Integrated';
                    description = subscale === 'LEG' ? 'Clear focus on leaving something behind' : 'Good emotional processing of life\'s finite nature';
                    colorClass = 'score-high';
                } else if (zScore > -0.5) {
                    emoji = '☺️';
                    label = subscale === 'LEG' ? 'Moderately Legacy-Minded' : 'Moderately Processed';
                    description = subscale === 'LEG' ? 'Some interest in lasting impact' : 'Some emotional integration of mortality';
                    colorClass = 'score-good';
                } else if (zScore > -1) {
                    emoji = '😕';
                    label = subscale === 'LEG' ? 'Minimally Legacy-Focused' : 'Struggling to Process';
                    description = subscale === 'LEG' ? 'Limited drive for lasting impact' : 'Difficulty emotionally integrating mortality';
                    colorClass = 'score-moderate';
                } else {
                    emoji = '😔';
                    label = subscale === 'LEG' ? 'No Legacy Drive' : 'Emotionally Unprocessed';
                    description = subscale === 'LEG' ? 'Little interest in creating lasting impact' : 'Significant difficulty processing mortality reality';
                    colorClass = 'score-problem';
                }
            } else {
                // Fear, Disempowerment, Disengagement: lower is better
                if (zScore < -1) {
                    emoji = '🤩';
                    if (subscale === 'FEAR') {
                        label = 'Exceptionally Calm';
                        description = 'Very low death-related anxiety';
                    } else if (subscale === 'Disemp') {
                        label = 'Feels Empowered';
                        description = 'Doesn\'t feel powerless against mortality';
                    } else { // Diseng
                        label = 'Mortality-Engaged';
                        description = 'Actively engages with mortality thoughts';
                    }
                    colorClass = 'score-high';
                } else if (zScore < -0.5) {
                    emoji = '☺️';
                    if (subscale === 'FEAR') {
                        label = 'Well-Managed Fear';
                        description = 'Low levels of death anxiety';
                    } else if (subscale === 'Disemp') {
                        label = 'Generally Empowered';
                        description = 'Low feelings of helplessness about death';
                    } else { // Diseng
                        label = 'Generally Engaged';
                        description = 'Comfortable thinking about mortality';
                    }
                    colorClass = 'score-good';
                } else if (zScore < 0.5) {
                    emoji = '😕';
                    if (subscale === 'FEAR') {
                        label = 'Moderate Fear Levels';
                        description = 'Typical death-related concerns';
                    } else if (subscale === 'Disemp') {
                        label = 'Mixed Feelings';
                        description = 'Sometimes feels powerless about mortality';
                    } else { // Diseng
                        label = 'Sometimes Avoidant';
                        description = 'Occasional avoidance of death thoughts';
                    }
                    colorClass = 'score-moderate';
                } else if (zScore < 1) {
                    emoji = '😔';
                    if (subscale === 'FEAR') {
                        label = 'Elevated Anxiety';
                        description = 'High levels of death-related fear';
                    } else if (subscale === 'Disemp') {
                        label = 'Often Feels Powerless';
                        description = 'Frequent feelings of helplessness against death';
                    } else { // Diseng
                        label = 'Actively Avoidant';
                        description = 'Frequently avoids mortality awareness';
                    }
                    colorClass = 'score-problem';
                } else {
                    emoji = '😔';
                    if (subscale === 'FEAR') {
                        label = 'Intense Death Anxiety';
                        description = 'Very high fear and distress';
                    } else if (subscale === 'Disemp') {
                        label = 'Deeply Powerless';
                        description = 'Overwhelming sense of vulnerability and helplessness';
                    } else { // Diseng
                        label = 'Completely Withdrawn';
                        description = 'Persistent withdrawal from mortality thoughts';
                    }
                    colorClass = 'score-problem';
                }
            }
            
            return { emoji, label, description, colorClass };
        }
        
        // Calculate Results
        async function calculateResults() {
            const results = MMAMM.scoring.processResponses(appState.responses);
            appState.results = results;
            
            console.log('Assessment Complete!');
            console.log('Results:', results);
            
            // Prepare data for storage (without email)
            const dataToStore = {
                sessionId: appState.sessionId,
                timestamp: new Date().toISOString(),
                demographics: appState.demographics,
                deathExperiences: appState.deathExperiences,
                responses: appState.responses,
                rawScores: results.rawScores,
                standardizedScores: results.standardizedScores,
                archetype: results.archetype.name,
                completedAt: new Date().toISOString()
            };
            
            // Try to save to Firebase
            const saved = await saveToFirebase(dataToStore);
            
            if (saved) {
                showStatus('Results saved successfully!');
            } else {
                showStatus('Unable to save results, but you can still view them.');
            }
            
            // Display archetype
            document.getElementById('archetypeName').textContent = results.archetype.name;
            document.getElementById('archetypeDescription').textContent = results.archetype.description;
            
            // Set archetype image
            const imageMap = {
                'The Fearful Visionary': 'fearful-visionary.png',
                'The Legacy Dreamer': 'legacy-dreamer.png',
                'The Mortality Denier': 'mortality-denier.png',
                'The Mortality Shadow': 'mortality-shadow.png',
                'The Mortality Drifter': 'mortality-drifter.png',
                'The Mortality Champion': 'mortality-champion.png',
                'The Legacy Weaver': 'legacy-weaver.png'
            };

            const archetypeImage = document.getElementById('archetypeImage');
            const imagePath = imageMap[results.archetype.name];
            if (imagePath) {
                archetypeImage.src = imagePath;
                archetypeImage.alt = `${results.archetype.name} illustration`;
            } else {
                // Hide image if no matching image found
                archetypeImage.style.display = 'none';
            }
            
            // Create modern score display
            createModernScoreDisplay(results.rawScores);
            
            showScreen('results');
            document.getElementById('progressContainer').classList.remove('show');
        }
        
        // Create Modern Score Display with Emojis
        function createModernScoreDisplay(rawScores) {
            const scoresContainer = document.getElementById('scoresContainer');
            
            const subscaleOrder = ['LEG', 'FEAR', 'ACC', 'Disemp', 'Diseng'];
            
            let scoreRowsHtml = '';
            
            subscaleOrder.forEach(key => {
                const score = rawScores[key];
                const subscale = MMAMM.subscales[key];
                const interpretation = getScoreInterpretation(key, score);
                
                scoreRowsHtml += `
                    <div class="score-row">
                        <div class="score-category">${subscale.name}</div>
                        <div class="score-emoji">${interpretation.emoji}</div>
                        <div class="score-status">
                            <div class="score-label">${interpretation.label}</div>
                            <div class="score-description">${interpretation.description}</div>
                        </div>
                        <div class="score-value ${interpretation.colorClass}">${score.toFixed(1)}/7</div>
                    </div>
                `;
            });
            
            scoresContainer.innerHTML = scoreRowsHtml;
        }
        
        // Email Modal Functions        
        function showEmailModal() {
            document.getElementById('emailModal').classList.add('show');
        }
        
        function closeEmailModal() {
            document.getElementById('emailModal').classList.remove('show');
            document.getElementById('successMessage').classList.remove('show');
            document.getElementById('firstName').value = '';
            document.getElementById('email').value = '';
        }
        
        // Generate score interpretations for email
        function getEmailScoreInterpretation(subscale, rawScore) {
            const mean = MMAMM.referenceData[subscale].mean;
            const std = MMAMM.referenceData[subscale].std;
            const zScore = (rawScore - mean) / std;
            
            if (zScore > 1) {
                return `Your score is significantly higher than average, indicating this is a prominent aspect of your mortality awareness.`;
            } else if (zScore > 0.5) {
                return `Your score is above average, suggesting this plays an important role in how you relate to mortality.`;
            } else if (zScore > -0.5) {
                return `Your score is close to average, indicating a balanced perspective on this dimension.`;
            } else if (zScore > -1) {
                return `Your score is below average, suggesting this is less prominent in your mortality awareness.`;
            } else {
                return `Your score is significantly lower than average, indicating this plays a minimal role in how you relate to mortality.`;
            }
        }

// Track if feedback has been submitted
    let feedbackSubmitted = false;
    
    // Function to save simple feedback
    async function submitFeedback(feedbackType) {
        try {
            if (!window.firebaseDB) {
                console.error('Firebase not initialized');
                return;
            }
            
            // Prevent multiple submissions
            if (feedbackSubmitted) {
                showStatus('Thank you! You\'ve already submitted feedback.');
                return;
            }
            
            const feedbackData = {
                feedbackType: feedbackType,
                sessionId: appState.sessionId,
                archetype: appState.results?.archetype?.name || 'Unknown',
                timestamp: new Date().toISOString()
            };
            
            const feedbackRef = window.firebaseRef(window.firebaseDB, 'feedback');
            await window.firebasePush(feedbackRef, feedbackData);
            
            console.log('Feedback saved:', feedbackType);
            
            // Mark as submitted
            feedbackSubmitted = true;
            
            // Visual feedback
            showStatus('Thank you for your feedback!');
            
            // Highlight the selected button
            document.querySelectorAll('.feedback-btn').forEach(btn => {
                btn.style.opacity = '0.5';
                btn.disabled = true;
            });
            event.target.style.opacity = '1';
            event.target.style.background = 'var(--orange-accent)';
            event.target.style.color = 'white';
            
        } catch (error) {
            console.error('Error saving feedback:', error);
            showStatus('Unable to save feedback, but thank you!');
        }
    }
    
    // Function to save detailed feedback
    async function submitDetailedFeedback() {
        try {
            const feedbackText = document.getElementById('additionalFeedback').value.trim();
            
            if (!feedbackText) {
                showStatus('Please enter some feedback first');
                return;
            }
            
            if (!window.firebaseDB) {
                console.error('Firebase not initialized');
                showStatus('Unable to save feedback, but thank you!');
                return;
            }
            
            const detailedFeedbackData = {
                feedback: feedbackText,
                sessionId: appState.sessionId,
                archetype: appState.results?.archetype?.name || 'Unknown',
                timestamp: new Date().toISOString()
            };
            
            const detailedFeedbackRef = window.firebaseRef(window.firebaseDB, 'detailed_feedback');
            await window.firebasePush(detailedFeedbackRef, detailedFeedbackData);
            
            console.log('Detailed feedback saved');
            
            // Clear the textarea and show success
            document.getElementById('additionalFeedback').value = '';
            document.getElementById('additionalFeedback').placeholder = 'Thank you for your feedback!';
            document.getElementById('additionalFeedback').disabled = true;
            
            // Disable the send button
            event.target.disabled = true;
            event.target.textContent = 'Feedback Sent!';
            
            showStatus('Thank you for your detailed feedback!');
            
        } catch (error) {
            console.error('Error saving detailed feedback:', error);
            showStatus('Unable to save feedback, but thank you!');
        }
    }
        
        // Updated Send Email function with emoji-based interpretations
async function sendEmail() {
    console.log('Starting email send process...');
    
    const firstName = document.getElementById('firstName').value.trim();
    const email = document.getElementById('email').value.trim();
    const emailConsent = document.getElementById('emailConsent').checked;
    const sendBtn = document.getElementById('sendEmailBtn');
    
    // Validation
    if (!firstName || !email) {
        alert('Please fill in all fields');
        return;
    }
    
    if (!email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
        alert('Please enter a valid email address');
        return;
    }
    
    // Initialize EmailJS if not already done
    if (window.emailjs && !window.emailjsInitialized) {
        try {
            emailjs.init("FpS7IboHIPBgSaspa");
            window.emailjsInitialized = true;
            console.log('EmailJS initialized successfully');
        } catch (initError) {
            console.error('EmailJS init error:', initError);
        }
    }
    
    if (!window.emailjs) {
        console.error('EmailJS not found on window object');
        alert('Email service is not available. Please refresh the page and try again.');
        return;
    }
    
    // Disable button and show loading
    sendBtn.disabled = true;
    sendBtn.innerHTML = '<span class="loading"></span> Sending...';
    
    // Update Firebase with email info
    if (window.firebaseDB && appState.sessionId) {
        try {
            const emailDataRef = window.firebaseRef(window.firebaseDB, `email_data/${appState.sessionId}`);
            await window.firebaseSet(emailDataRef, {
                sessionId: appState.sessionId,
                firstName: firstName,
                email: email,
                emailConsent: emailConsent,
                emailedAt: new Date().toISOString()
            });
            console.log('Email data saved to Firebase');
        } catch (error) {
            console.error('Error saving email data:', error);
        }
    }
    
    // Helper function to create detailed email interpretations
    function getDetailedEmailInterpretation(subscale, rawScore) {
        const interpretation = getScoreInterpretation(subscale, rawScore);
        const emoji = interpretation.emoji;
        const label = interpretation.label;
        const description = interpretation.description;
        
        // Create a comprehensive interpretation for email
        let detailedText = `${emoji} ${label} - ${description}. `;
        
        // Add additional context based on the score
        const mean = MMAMM.referenceData[subscale].mean;
        const std = MMAMM.referenceData[subscale].std;
        const zScore = (rawScore - mean) / std;
        
        // Add personalized insights based on subscale
        if (subscale === 'LEG') {
            if (zScore > 0.5) {
                detailedText += "You have a strong drive to create something meaningful that will outlast you. This may manifest in creative projects, mentoring others, or building institutions. Consider channeling this energy into concrete legacy projects.";
            } else if (zScore < -0.5) {
                detailedText += "You're less focused on leaving a traditional legacy, which can free you to live more in the present moment. This isn't a weakness - it may mean you find meaning in immediate experiences rather than future impact.";
            } else {
                detailedText += "You have a balanced approach to legacy - interested but not consumed by it. This allows you to appreciate both present experiences and future impact.";
            }
        } else if (subscale === 'FEAR') {
            if (zScore < -0.5) {
                detailedText += "Your low death anxiety is a strength that allows you to engage with life more fully. You can discuss mortality without significant distress, which helps in making important life decisions.";
            } else if (zScore > 0.5) {
                detailedText += "Your heightened awareness of mortality creates anxiety that may be limiting your choices. Consider exploring what specific aspects of death concern you most - often naming fears reduces their power.";
            } else {
                detailedText += "You experience typical levels of death-related concern. This natural anxiety can be a motivator without being overwhelming.";
            }
        } else if (subscale === 'ACC') {
            if (zScore > 0.5) {
                detailedText += "Your acceptance of mortality is a profound strength. This emotional integration allows you to make decisions from a place of wisdom rather than fear, and to appreciate life's preciousness.";
            } else if (zScore < -0.5) {
                detailedText += "You're still processing the reality of mortality, which is completely normal. Acceptance often develops through life experience and reflection. There's no rush to 'accept' death - work with where you are.";
            } else {
                detailedText += "You're in the process of integrating mortality into your worldview. This ongoing journey of acceptance can deepen your appreciation for life.";
            }
        } else if (subscale === 'Disemp') {
            if (zScore < -0.5) {
                detailedText += "You maintain a sense of agency despite mortality's inevitability. This empowerment allows you to take meaningful action rather than feeling paralyzed by life's finite nature.";
            } else if (zScore > 0.5) {
                detailedText += "Feeling powerless against mortality is affecting your sense of agency. Remember that while death is inevitable, how you live is entirely in your control. Small, meaningful actions can restore your sense of power.";
            } else {
                detailedText += "You sometimes struggle with feelings of powerlessness about mortality. This is a common human experience - finding areas where you do have control can help balance these feelings.";
            }
        } else if (subscale === 'Diseng') {
            if (zScore < -0.5) {
                detailedText += "You actively engage with thoughts about mortality rather than avoiding them. This engagement, while sometimes uncomfortable, often leads to more intentional living and clearer priorities.";
            } else if (zScore > 0.5) {
                detailedText += "You tend to avoid thinking about death, which is a common protective mechanism. While this can reduce anxiety short-term, gradual engagement with mortality (at your own pace) often leads to greater life satisfaction.";
            } else {
                detailedText += "You have a moderate level of engagement with mortality thoughts. This balance allows you to function without obsessing, while still maintaining some awareness of life's finite nature.";
            }
        }
        
        return detailedText;
    }

    
    // NEW FUNCTION - Helper function to get personalized insights for email
    function getPersonalizedInsight(subscale, rawScore) {
        const mean = MMAMM.referenceData[subscale].mean;
        const std = MMAMM.referenceData[subscale].std;
        const zScore = (rawScore - mean) / std;
        
        if (subscale === 'LEG') {
            if (zScore > 0.5) {
                return "Your strong legacy drive suggests you find deep meaning in creating something that will outlast you. Consider channeling this energy into concrete projects - whether that's mentoring others, creating art, or building institutions. The key is to start now rather than waiting for the 'perfect' moment.";
            } else if (zScore < -0.5) {
                return "You're less focused on traditional legacy, which can be liberating. You might find more meaning in present-moment experiences and immediate connections rather than future monuments. This perspective allows you to live more fully in the now.";
            } else {
                return "Your balanced approach to legacy allows you to appreciate both present experiences and future impact. You can create meaningful contributions without being consumed by them.";
            }
        } else if (subscale === 'FEAR') {
            if (zScore < -0.5) {
                return "Your low death anxiety is a strength that allows you to engage with life more fully. You can discuss mortality without significant distress, which helps in making important life decisions.";
            } else if (zScore > 0.5) {
                return "Your heightened awareness of mortality creates anxiety that may be limiting your choices. Consider exploring what specific aspects of death concern you most - often naming fears reduces their power.";
            } else {
                return "You experience typical levels of death-related concern. This natural anxiety can be a motivator without being overwhelming.";
            }
        } else if (subscale === 'ACC') {
            if (zScore > 0.5) {
                return "Your acceptance of mortality is a profound strength. This emotional integration allows you to make decisions from a place of wisdom rather than fear, and to appreciate life's preciousness.";
            } else if (zScore < -0.5) {
                return "You're still processing the reality of mortality, which is completely normal. Acceptance often develops through life experience and reflection. There's no rush to 'accept' death - work with where you are.";
            } else {
                return "You're in the process of integrating mortality into your worldview. This ongoing journey of acceptance can deepen your appreciation for life.";
            }
        } else if (subscale === 'Disemp') {
            if (zScore < -0.5) {
                return "You maintain a sense of agency despite mortality's inevitability. This empowerment allows you to take meaningful action rather than feeling paralyzed by life's finite nature.";
            } else if (zScore > 0.5) {
                return "Feeling powerless against mortality is affecting your sense of agency. Remember that while death is inevitable, how you live is entirely in your control. Small, meaningful actions can restore your sense of power.";
            } else {
                return "You sometimes struggle with feelings of powerlessness about mortality. This is a common human experience - finding areas where you do have control can help balance these feelings.";
            }
        } else if (subscale === 'Diseng') {
            if (zScore < -0.5) {
                return "You actively engage with thoughts about mortality rather than avoiding them. This engagement, while sometimes uncomfortable, often leads to more intentional living and clearer priorities.";
            } else if (zScore > 0.5) {
                return "You tend to avoid thinking about death, which is a common protective mechanism. While this can reduce anxiety short-term, gradual engagement with mortality (at your own pace) often leads to greater life satisfaction.";
            } else {
                return "You have a moderate level of engagement with mortality thoughts. This balance allows you to function without obsessing, while still maintaining some awareness of life's finite nature.";
            }
        }
    }
    // Prepare email data with detailed interpretations
    // In the templateParams, update to include all the separate parts:
const templateParams = {
    to_email: email,
    user_name: firstName,
    archetype_name: appState.results.archetype.name,
    archetype_description: appState.results.archetype.description,
    archetype_image_url: `https://mortals-community.github.io/mortality-attitude-profile/${appState.results.archetype.name.toLowerCase().replace('the ', '').replace(/ /g, '-')}.png`,
    
    // Scores
    leg_score: appState.results.rawScores.LEG.toFixed(1),
    fear_score: appState.results.rawScores.FEAR.toFixed(1),
    acc_score: appState.results.rawScores.ACC.toFixed(1),
    disemp_score: appState.results.rawScores.Disemp.toFixed(1),
    diseng_score: appState.results.rawScores.Diseng.toFixed(1),
    
    // Legacy
    leg_emoji: getScoreInterpretation('LEG', appState.results.rawScores.LEG).emoji,
    leg_label: getScoreInterpretation('LEG', appState.results.rawScores.LEG).label,
    leg_description: getScoreInterpretation('LEG', appState.results.rawScores.LEG).description,
    leg_insight: getPersonalizedInsight('LEG', appState.results.rawScores.LEG),
    
    // Fear
    fear_emoji: getScoreInterpretation('FEAR', appState.results.rawScores.FEAR).emoji,
    fear_label: getScoreInterpretation('FEAR', appState.results.rawScores.FEAR).label,
    fear_description: getScoreInterpretation('FEAR', appState.results.rawScores.FEAR).description,
    fear_insight: getPersonalizedInsight('FEAR', appState.results.rawScores.FEAR),
    
    // Acceptance
    acc_emoji: getScoreInterpretation('ACC', appState.results.rawScores.ACC).emoji,
    acc_label: getScoreInterpretation('ACC', appState.results.rawScores.ACC).label,
    acc_description: getScoreInterpretation('ACC', appState.results.rawScores.ACC).description,
    acc_insight: getPersonalizedInsight('ACC', appState.results.rawScores.ACC),
    
    // Disempowerment
    disemp_emoji: getScoreInterpretation('Disemp', appState.results.rawScores.Disemp).emoji,
    disemp_label: getScoreInterpretation('Disemp', appState.results.rawScores.Disemp).label,
    disemp_description: getScoreInterpretation('Disemp', appState.results.rawScores.Disemp).description,
    disemp_insight: getPersonalizedInsight('Disemp', appState.results.rawScores.Disemp),
    
    // Disengagement
    diseng_emoji: getScoreInterpretation('Diseng', appState.results.rawScores.Diseng).emoji,
    diseng_label: getScoreInterpretation('Diseng', appState.results.rawScores.Diseng).label,
    diseng_description: getScoreInterpretation('Diseng', appState.results.rawScores.Diseng).description,
    diseng_insight: getPersonalizedInsight('Diseng', appState.results.rawScores.Diseng)
};
    
    try {
        const response = await emailjs.send('service_cym10iv', 'template_zj4e18l', templateParams);
        console.log('Email sent successfully:', response);
        
        document.getElementById('successMessage').classList.add('show');
        
        setTimeout(() => {
            sendBtn.disabled = false;
            sendBtn.innerHTML = 'Send Results';
        }, 2000);
        
    } catch (error) {
        console.error('Email error:', error);
        alert('Sorry, there was an error sending your results. Please try again.');
        sendBtn.disabled = false;
        sendBtn.innerHTML = 'Send Results';
    }
}
        
        // Start Over
        function startOver() {
            if (confirm('Are you sure you want to start over? Your current results will be lost.')) {
                location.reload();
            }
        }
        
        // Initialize EmailJS on load
        window.addEventListener('load', () => {
            // Check if Firebase is loaded
            setTimeout(() => {
                if (window.firebaseDB) {
                    console.log('Firebase initialized successfully');
                    showStatus('Connected to database');
                } else {
                    console.warn('Firebase not initialized - data will not be saved');
                }
            }, 2000);
        });

        // Add these functions to your existing script section

// Quick feedback function
function submitFeedback(feedbackType) {
    if (!window.firebaseDB) {
        console.log('Feedback:', feedbackType);
        showStatus('Feedback recorded (offline mode)');
        return;
    }
    
    try {
        const feedbackRef = window.firebaseRef(window.firebaseDB, 'feedback');
        window.firebasePush(feedbackRef, {
            sessionId: appState.sessionId,
            feedbackType: feedbackType,
            timestamp: new Date().toISOString(),
            archetype: appState.results?.archetype?.name || 'unknown'
        });
        
        // Visual feedback to user
        showStatus('Thanks for your feedback!');
        
        // Highlight the clicked button
        event.target.style.background = '#4CAF50';
        event.target.style.color = 'white';
        setTimeout(() => {
            event.target.style.background = '';
            event.target.style.color = '';
        }, 2000);
        
    } catch (error) {
        console.error('Error saving feedback:', error);
        showStatus('Feedback saved locally');
    }
}

// Detailed feedback function
function submitDetailedFeedback() {
    const additionalText = document.getElementById('additionalFeedback').value.trim();
    
    if (!additionalText) {
        alert('Please enter some feedback before submitting');
        return;
    }
    
    if (!window.firebaseDB) {
        console.log('Detailed feedback:', additionalText);
        showStatus('Feedback recorded (offline mode)');
        document.getElementById('additionalFeedback').value = '';
        return;
    }
    
    try {
        const feedbackRef = window.firebaseRef(window.firebaseDB, 'detailed_feedback');
        window.firebasePush(feedbackRef, {
            sessionId: appState.sessionId,
            feedback: additionalText,
            timestamp: new Date().toISOString(),
            archetype: appState.results?.archetype?.name || 'unknown'
        });
        
        showStatus('Thanks for your detailed feedback!');
        document.getElementById('additionalFeedback').value = '';
        
    } catch (error) {
        console.error('Error saving detailed feedback:', error);
        showStatus('Feedback saved locally');
    }
}
    </script>
</body>
</html>
