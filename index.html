<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Discover your unique relationship with mortality through this research-based assessment. Find out which of seven mortality types best describes you.">
    <meta name="author" content="Mortals">
    <title>Discover your Mortality Type - Mortals</title>
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    
    <!-- Google Fonts - Solway -->
    <link href="https://fonts.googleapis.com/css2?family=Solway:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAvcg2qMytGsdjtSR3TJNvB2co1_elmmuk",
            authDomain: "mortality-attitude-profile.firebaseapp.com",
            databaseURL: "https://mortality-attitude-profile-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mortality-attitude-profile",
            storageBucket: "mortality-attitude-profile.firebasestorage.app",
            messagingSenderId: "533303225736",
            appId: "1:533303225736:web:6b0dc8f17fe95dd5659e3d",
            measurementId: "G-VDVS16QL7Q"
        };
        
        try {
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);
            
            window.firebaseDB = database;
            window.firebaseRef = ref;
            window.firebasePush = push;
            window.firebaseOnValue = onValue;
            window.firebaseSet = set;
            window.firebaseInitialized = true;
        } catch (error) {
            console.error('Firebase initialization error:', error);
            window.firebaseInitialized = false;
        }
    </script>
    
    <style>
        /* CSS Variables */
        :root {
            --orange-accent: #FF6B35;
            --blue-accent: #004E89;
            --primary-white: #FFF7F3;
            --primary-orange: #F7C59F;
            --text-dark: #004E89;
            --gray-light: #E0E0E0;
            --gray-medium: #999;
            --bright-orange: #FF8C42;
            --success-green: #4CAF50;
            --error-red: #ef4444;
            --warning-yellow: #f59e0b;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Safe areas for mobile */
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
        }
        
        /* Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Base */
        html {
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            font-family: 'Solway', serif;
            background-color: var(--primary-white);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overflow-x: hidden;
        }
        
        /* Container */
        .app-container {
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* Screen Layout */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            padding: var(--spacing-lg);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            z-index: 1;
        }
        
        .screen.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            z-index: 10;
        }
        
        .screen.exit {
            opacity: 0;
            transform: translateY(-20px);
        }
        
        /* Content Container */
        .content {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }
        
        /* Typography */
        h1 {
            font-size: clamp(1.75rem, 5vw, 3rem);
            font-weight: 800;
            margin-bottom: var(--spacing-lg);
            line-height: 1.2;
            color: var(--text-dark);
        }
        
        h2 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            line-height: 1.3;
            color: var(--text-dark);
        }
        
        h3 {
            font-size: clamp(1.25rem, 3vw, 1.5rem);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--orange-accent);
        }
        
        p {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            font-weight: 300;
            line-height: 1.6;
            margin-bottom: var(--spacing-lg);
            color: var(--gray-medium);
        }
        
        /* Landing Image */
        .landing-image {
            width: min(200px, 50vw);
            height: auto;
            margin: 0 auto var(--spacing-lg);
            display: block;
            object-fit: contain;
        }
        
        .landing-image.error {
            display: none;
        }
        
        /* Buttons */
        .btn {
            display: inline-block;
            background: var(--orange-accent);
            color: white;
            border: none;
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: clamp(1rem, 2.5vw, 1.1rem);
            font-weight: 500;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Solway', serif;
            margin: var(--spacing-sm);
            text-align: center;
            text-decoration: none;
            position: relative;
            z-index: 1;
            touch-action: manipulation;
            user-select: none;
            min-width: 120px;
        }
        
        .btn:hover:not(:disabled) {
            background: #ff5722;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.3);
        }
        
        .btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--orange-accent);
            border: 2px solid var(--orange-accent);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--orange-accent);
            color: white;
        }
        
        /* Option Buttons */
        .btn-option {
            background: white;
            color: var(--text-dark);
            border: 2px solid var(--gray-light);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: 1rem;
            font-weight: 500;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Solway', serif;
            touch-action: manipulation;
        }
        
        .btn-option:hover:not(:disabled) {
            border-color: var(--orange-accent);
            transform: translateY(-2px);
        }
        
        .btn-option.selected {
            background: var(--orange-accent);
            color: white;
            border-color: var(--orange-accent);
        }
        
        /* Forms */
        .form-group {
            margin-bottom: var(--spacing-xl);
        }
        
        .form-group label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 1rem;
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            background: white;
            font-family: 'Solway', serif;
            color: var(--text-dark);
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--orange-accent);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        /* Brand Footer */
        .brand-footer {
            position: fixed;
            bottom: var(--spacing-lg);
            left: 50%;
            transform: translateX(-50%);
            z-index: 5;
            padding-bottom: var(--safe-area-inset-bottom);
        }
        
        .logo {
            width: 50px;
            height: 50px;
        }
        
        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* Progress Bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 247, 243, 0.98);
            padding: var(--spacing-lg);
            padding-top: calc(var(--spacing-lg) + var(--safe-area-inset-top));
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .progress-container.show {
            opacity: 1;
            visibility: visible;
        }
        
        .progress-text {
            text-align: center;
            font-size: 0.9rem;
            color: var(--gray-medium);
            margin-bottom: var(--spacing-sm);
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--gray-light);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--orange-accent), var(--bright-orange));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Questions */
        .question-wrapper {
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .question-slide {
            width: 100%;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .question-slide.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        .question-text {
            font-size: clamp(1.1rem, 3vw, 1.5rem);
            font-weight: 400;
            margin-bottom: var(--spacing-2xl);
            line-height: 1.4;
            text-align: center;
        }
        
        /* Likert Scale */
        .likert-container {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .likert-scale {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-2xl);
            flex-wrap: wrap;
        }
        
        .likert-label {
            font-size: clamp(0.75rem, 2vw, 0.9rem);
            color: var(--gray-medium);
            font-weight: 400;
            text-align: center;
            flex: 0 0 auto;
        }
        
        .likert-options {
            display: flex;
            gap: clamp(8px, 2vw, 15px);
            padding: 0 var(--spacing-sm);
        }
        
        .likert-option {
            width: clamp(35px, 8vw, 50px);
            height: clamp(35px, 8vw, 50px);
            border-radius: 50%;
            border: 2px solid var(--gray-light);
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: clamp(0.85rem, 2vw, 1rem);
            touch-action: manipulation;
        }
        
        .likert-option:hover:not(:disabled) {
            border-color: var(--orange-accent);
            transform: scale(1.1);
        }
        
        .likert-option:focus-visible {
            outline: 3px solid var(--orange-accent);
            outline-offset: 2px;
        }
        
        .likert-option.selected {
            background: var(--orange-accent);
            border-color: var(--orange-accent);
            color: white;
            transform: scale(1.05);
        }
        
        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }
        
        .checkbox-group input[type="checkbox"] {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            font-size: 0.9rem;
            line-height: 1.4;
            cursor: pointer;
            text-align: left;
            color: var(--gray-medium);
        }
        
        /* Results */
        .results-container {
            padding: var(--spacing-2xl);
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 78, 137, 0.1);
            max-width: 700px;
            margin: 0 auto;
        }
        
        .results-container.has-image {
            padding-top: 0;
            overflow: hidden;
        }
        
        .archetype-image {
            width: calc(100% + calc(var(--spacing-2xl) * 2));
            margin: calc(var(--spacing-2xl) * -1) calc(var(--spacing-2xl) * -1) var(--spacing-xl);
            height: 300px;
            object-fit: cover;
            border-radius: 20px 20px 0 0;
            background: var(--gray-light);
        }
        
        .archetype-result {
            margin-bottom: var(--spacing-2xl);
            text-align: center;
        }
        
        .archetype-result h3 {
            color: var(--blue-accent);
            font-weight: 400;
            margin-bottom: var(--spacing-sm);
        }
        
        .archetype-result h2 {
            color: var(--text-dark);
            margin-bottom: var(--spacing-md);
        }
        
        .archetype-result p {
            color: var(--text-dark);
            font-size: 1.1rem;
            font-weight: 700;
            text-align: left;
        }
        
        /* Score Display */
        .scores-section {
            margin: var(--spacing-2xl) 0;
        }
        
        .scores-title {
            font-size: 1.3rem;
            font-weight: 400;
            color: var(--blue-accent);
            margin-bottom: var(--spacing-xl);
            text-align: center;
        }
        
        .score-row {
            display: grid;
            grid-template-columns: 100px 60px 1fr 70px;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .score-row:last-child {
            border-bottom: none;
        }
        
        .score-category {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .score-emoji {
            font-size: 1.8rem;
            text-align: center;
        }
        
        .score-status {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .score-label {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .score-description {
            font-size: 0.85rem;
            color: var(--gray-medium);
        }
        
        .score-value {
            font-size: 0.9rem;
            text-align: right;
            font-weight: 600;
        }
        
        .score-high { color: var(--success-green); }
        .score-good { color: var(--blue-accent); }
        .score-moderate { color: var(--warning-yellow); }
        .score-problem { color: var(--error-red); }
        
        /* Feedback */
        .feedback-section {
            margin-top: var(--spacing-2xl);
            padding: var(--spacing-xl);
            background: #f8f9fa;
            border-radius: 15px;
            text-align: center;
        }
        
        .feedback-section h3 {
            color: var(--text-dark);
            margin-bottom: var(--spacing-lg);
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .feedback-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            justify-content: center;
            margin-bottom: var(--spacing-lg);
        }
        
        .feedback-btn {
            background: white;
            color: var(--text-dark);
            border: 2px solid var(--gray-light);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Solway', serif;
            font-size: 0.9rem;
        }
        
        .feedback-btn:hover:not(:disabled) {
            border-color: var(--orange-accent);
            transform: translateY(-2px);
        }
        
        .feedback-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .feedback-btn.selected {
            background: var(--orange-accent);
            color: white;
            border-color: var(--orange-accent);
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: var(--spacing-lg);
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            padding: var(--spacing-2xl);
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.show .modal-content {
            transform: scale(1);
        }
        
        .close-modal {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            font-size: 30px;
            cursor: pointer;
            color: var(--gray-medium);
            background: none;
            border: none;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            background: var(--gray-light);
            color: var(--text-dark);
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Status Message */
        .status-message {
            position: fixed;
            bottom: calc(100px + var(--safe-area-inset-bottom));
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: 30px;
            font-size: 0.9rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 200;
            max-width: 90%;
            text-align: center;
        }
        
        .status-message.show {
            opacity: 1;
            visibility: visible;
        }
        
        /* Success Message */
        .success-message {
            background: var(--success-green);
            color: white;
            padding: var(--spacing-md);
            border-radius: 8px;
            margin-top: var(--spacing-md);
            display: none;
            text-align: center;
        }
        
        .success-message.show {
            display: block;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .content {
                padding: var(--spacing-md);
            }
            
            .score-row {
                grid-template-columns: 1fr;
                gap: var(--spacing-sm);
                padding: var(--spacing-lg) 0;
            }
            
            .score-category {
                font-size: 1rem;
                margin-bottom: var(--spacing-xs);
            }
            
            .score-emoji {
                display: none;
            }
            
            .score-value {
                text-align: left;
                font-size: 1rem;
                color: var(--orange-accent);
            }
            
            .likert-scale {
                flex-direction: column;
                gap: var(--spacing-md);
            }
            
            .likert-options {
                order: 2;
            }
            
            .likert-label:first-child {
                order: 1;
            }
            
            .likert-label:last-child {
                order: 3;
            }
            
            .results-container {
                padding: var(--spacing-lg);
            }
            
            .archetype-image {
                height: 200px;
                margin: calc(var(--spacing-lg) * -1) calc(var(--spacing-lg) * -1) var(--spacing-md);
            }
            
            .modal-content {
                padding: var(--spacing-lg);
            }
            
            .btn-option {
                display: block;
                width: 100%;
                margin-bottom: var(--spacing-sm);
            }
        }
        
        @media (max-width: 380px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .landing-image {
                width: 120px;
            }
            
            .likert-option {
                width: 32px;
                height: 32px;
                font-size: 0.8rem;
            }
        }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Focus visible for keyboard navigation */
        *:focus-visible {
            outline: 3px solid var(--orange-accent);
            outline-offset: 2px;
        }
        
        /* Skip to content link for screen readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--orange-accent);
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            text-decoration: none;
            z-index: 1000;
        }
        
        .skip-link:focus {
            top: 0;
        }
        
        /* Print styles */
        @media print {
            .btn,
            .modal,
            .status-message,
            .progress-container,
            .brand-footer {
                display: none !important;
            }
            
            .screen {
                position: static !important;
                opacity: 1 !important;
                transform: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <div class="app-container" id="main-content">
        <!-- Landing Screen -->
        <div class="screen active" id="landingScreen" role="main" aria-label="Welcome screen">
            <div class="content">
                <img src="map-landing.png" 
                     alt="Mortality Attitude Profile illustration" 
                     class="landing-image"
                     onerror="this.classList.add('error')"
                     loading="eager">
                <h1>Discover what really drives you</h1>
                <p>Death is the one experience we all share, yet each of us relates to it differently...</p>
                <button class="btn" onclick="startAssessment()" aria-label="Start the mortality attitude assessment">
                    Who are you?
                </button>
            </div>
        </div>

        <!-- Intro Screens -->
        <div class="screen" id="intro1Screen" role="main" aria-label="Introduction page 1">
            <div class="content">
                <h2>How do you relate to life's biggest certainty?</h2>
                <div style="max-width: 700px; margin: 0 auto; text-align: left;">
                    <p style="color: var(--text-dark); font-size: 1.1rem;">
                        The Mortality Attitude Profile (MAP) is a research-based quiz that helps you understand your unique relationship with mortality. Through 36 carefully crafted questions, you'll discover which of seven distinct "mortality types" best describes how you engage with life's finite nature.
                    </p>
                    <p style="color: var(--text-dark); font-size: 1.1rem;">
                        This isn't about being morbid or pessimistic – it's about self-awareness. Understanding how you relate to mortality can unlock insights about what drives you, what holds you back, and what truly matters in your life.
                    </p>
                </div>
                <button class="btn" onclick="showScreen('intro2')">Next →</button>
            </div>
        </div>

        <div class="screen" id="intro2Screen" role="main" aria-label="Introduction page 2">
            <div class="content">
                <h2>Built on peer-reviewed research</h2>
                <div style="max-width: 700px; margin: 0 auto; text-align: left;">
                    <p style="color: var(--text-dark); font-size: 1.1rem;">
                        The MAP is based on research developed by psychologists. This framework emerged from studying hundreds of people across diverse backgrounds.
                    </p>
                    <p style="color: var(--text-dark); font-size: 1.1rem;">
                        The research identified five key dimensions of mortality awareness:
                    </p>
                    <ul style="list-style: none; padding: 0; margin-bottom: var(--spacing-xl);">
                        <li style="margin-bottom: var(--spacing-md); padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                            <strong>Legacy</strong> - The drive to create something lasting
                        </li>
                        <li style="margin-bottom: var(--spacing-md); padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                            <strong>Fear</strong> - Anxiety about death and dying
                        </li>
                        <li style="margin-bottom: var(--spacing-md); padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                            <strong>Acceptance</strong> - Integration of mortality into your worldview
                        </li>
                        <li style="margin-bottom: var(--spacing-md); padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                            <strong>Disempowerment</strong> - Feelings of helplessness against mortality
                        </li>
                        <li style="margin-bottom: var(--spacing-md); padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                            <strong>Disengagement</strong> - Avoidance of death-related thoughts
                        </li>
                    </ul>
                    <p style="color: var(--text-dark); font-size: 1.1rem;">
                        Your unique pattern across these dimensions determines your mortality type.
                    </p>
                </div>
                <button class="btn" onclick="showScreen('intro3')">Next →</button>
            </div>
        </div>

        <div class="screen" id="intro3Screen" role="main" aria-label="Introduction page 3">
            <div class="content">
                <h2>Your personalised mortality type</h2>
                <div style="max-width: 700px; margin: 0 auto; text-align: left;">
                    <p style="color: var(--text-dark); font-size: 1.1rem;">
                        In the next 5-7 minutes, you'll answer questions about your thoughts, feelings, and attitudes toward mortality. There are no right or wrong answers – only honest reflections of your personal experience.
                    </p>
                    <p style="color: var(--text-dark); font-size: 1.1rem;">
                        After completing the assessment, you'll receive:
                    </p>
                    <ul style="list-style: none; padding: 0; margin-bottom: var(--spacing-xl);">
                        <li style="margin-bottom: var(--spacing-md); padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                            <strong>Your Mortality Type</strong> - One of seven evidence-based types
                        </li>
                        <li style="margin-bottom: var(--spacing-md); padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                            <strong>Your Dimension Scores</strong> - How you score on each dimension
                        </li>
                        <li style="margin-bottom: var(--spacing-md); padding-left: 30px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--orange-accent);">•</span>
                            <strong>Full Analysis</strong> - Detailed interpretation via email
                        </li>
                    </ul>
                    <p style="color: var(--text-dark); font-size: 1.1rem;">
                        Ready to begin?
                    </p>
                </div>
                <button class="btn" onclick="showScreen('demographics')">Let's go →</button>
            </div>
        </div>
        
        <!-- Demographics Screen -->
        <div class="screen" id="demographicsScreen" role="main" aria-label="Demographics">
            <div class="content">
                <h2>Tell us a bit about yourself</h2>
                <p>This helps us understand patterns across different groups</p>
                
                <div class="form-group">
                    <label for="ageRange">Age range</label>
                    <select id="ageRange" onchange="checkDemographics()" aria-required="true">
                        <option value="">Select your age range</option>
                        <option value="18-24">18-24</option>
                        <option value="25-34">25-34</option>
                        <option value="35-44">35-44</option>
                        <option value="45-54">45-54</option>
                        <option value="55-64">55-64</option>
                        <option value="65+">65+</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="sex">Sex</label>
                    <select id="sex" onchange="checkDemographics()" aria-required="true">
                        <option value="">Select an option</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                        <option value="prefer-not">Prefer not to say</option>
                    </select>
                </div>
                
                <button class="btn next-btn" id="demographicsNext" onclick="proceedFromDemographics()" disabled>
                    Continue
                </button>
            </div>
        </div>

        <!-- Death Experience Screen -->
        <div class="screen" id="deathExperienceScreen" role="main" aria-label="Life experiences">
            <div class="content">
                <h2>Life Experiences</h2>
                <p>Understanding your past experiences helps us provide more personalized insights</p>
                
                <div class="form-group">
                    <label>Have you ever had a life threatening illness?</label>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                        <button class="btn-option" id="illness-yes" onclick="setDeathExperience('illness', true)">Yes</button>
                        <button class="btn-option" id="illness-no" onclick="setDeathExperience('illness', false)">No</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Have you ever been emotionally close to someone who has had a life threatening illness?</label>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                        <button class="btn-option" id="closeIllness-yes" onclick="setDeathExperience('closeIllness', true)">Yes</button>
                        <button class="btn-option" id="closeIllness-no" onclick="setDeathExperience('closeIllness', false)">No</button>
                    </div>
                </div>
                
                <div class="form-group" id="closeIllnessScale" style="display: none;">
                    <label>How emotionally close were you to that person during their illness?</label>
                    <div class="likert-scale" style="margin-top: 20px;">
                        <span class="likert-label">Not close<br>at all</span>
                        <div class="likert-options">
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 1)">1</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 2)">2</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 3)">3</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 4)">4</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 5)">5</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 6)">6</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeIllnessLevel', 7)">7</button>
                        </div>
                        <span class="likert-label">Extremely<br>close</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Have you ever been close to dying?</label>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                        <button class="btn-option" id="closeDying-yes" onclick="setDeathExperience('closeDying', true)">Yes</button>
                        <button class="btn-option" id="closeDying-no" onclick="setDeathExperience('closeDying', false)">No</button>
                    </div>
                </div>
                
                <div class="form-group" id="closeDyingScale" style="display: none;">
                    <label>How close to death did you come?</label>
                    <div class="likert-scale" style="margin-top: 20px;">
                        <span class="likert-label">Not very<br>close</span>
                        <div class="likert-options">
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 1)">1</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 2)">2</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 3)">3</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 4)">4</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 5)">5</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 6)">6</button>
                            <button class="likert-option" onclick="setDeathExperienceScale('closeDyingLevel', 7)">7</button>
                        </div>
                        <span class="likert-label">Extremely<br>close</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Have you ever seen someone die?</label>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                        <button class="btn-option" id="seenDie-yes" onclick="setDeathExperience('seenDie', true)">Yes</button>
                        <button class="btn-option" id="seenDie-no" onclick="setDeathExperience('seenDie', false)">No</button>
                    </div>
                </div>
                
                <button class="btn next-btn" id="deathExperienceNext" onclick="startQuestions()" disabled>
                    Continue
                </button>
            </div>
        </div>
        
        <!-- Question Screen -->
        <div class="screen" id="questionScreen" role="main" aria-label="Assessment questions">
            <div class="content">
                <div class="question-wrapper">
                    <div class="question-slide active" id="questionSlide">
                        <h2 class="question-text" id="questionText" role="heading" aria-level="2">
                            Question text will appear here
                        </h2>
                        
                        <div class="likert-container" role="group" aria-label="Response scale">
                            <div class="likert-scale">
                                <span class="likert-label">Strongly<br>Disagree</span>
                                <div class="likert-options" id="likertOptions">
                                    <button class="likert-option" data-value="1" onclick="selectOption(1)" aria-label="1 - Strongly disagree">1</button>
                                    <button class="likert-option" data-value="2" onclick="selectOption(2)" aria-label="2">2</button>
                                    <button class="likert-option" data-value="3" onclick="selectOption(3)" aria-label="3">3</button>
                                    <button class="likert-option" data-value="4" onclick="selectOption(4)" aria-label="4 - Neutral">4</button>
                                    <button class="likert-option" data-value="5" onclick="selectOption(5)" aria-label="5">5</button>
                                    <button class="likert-option" data-value="6" onclick="selectOption(6)" aria-label="6">6</button>
                                    <button class="likert-option" data-value="7" onclick="selectOption(7)" aria-label="7 - Strongly agree">7</button>
                                </div>
                                <span class="likert-label">Strongly<br>Agree</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div class="screen" id="resultsScreen" role="main" aria-label="Your results">
            <div class="content">
                <div class="results-container has-image">
                    <img id="archetypeImage" 
                         class="archetype-image" 
                         src="" 
                         alt="Your mortality type illustration"
                         onerror="this.style.display='none'"
                         loading="lazy">
                    <div class="archetype-result">
                        <h3>Your mortality type</h3>
                        <h2 id="archetypeName">Your Archetype</h2>
                        <p id="archetypeDescription">Description will appear here</p>
                    </div>
                    
                    <div class="scores-section">
                        <h2 class="scores-title">Your type explained</h2>
                        <div id="scoresContainer" role="list" aria-label="Dimension scores">
                            <!-- Score rows will be dynamically inserted here -->
                        </div>
                    </div>

                    <div class="feedback-section">
                        <h3>What do you think?</h3>
                        <div class="feedback-buttons" role="group" aria-label="Quick feedback options">
                            <button class="feedback-btn" onclick="submitFeedback('easy', this)">Easy to use</button>
                            <button class="feedback-btn" onclick="submitFeedback('confusing', this)">Confusing</button>
                            <button class="feedback-btn" onclick="submitFeedback('accurate', this)">Results feel accurate</button>
                            <button class="feedback-btn" onclick="submitFeedback('inaccurate', this)">Results don't fit me</button>
                            <button class="feedback-btn" onclick="submitFeedback('too-long', this)">Too long</button>
                            <button class="feedback-btn" onclick="submitFeedback('just-right', this)">Perfect length</button>
                        </div>
                        <textarea id="additionalFeedback" 
                                  placeholder="Any other thoughts? (optional)" 
                                  maxlength="500"
                                  aria-label="Additional feedback"></textarea>
                        <button class="btn-secondary" onclick="submitDetailedFeedback()">Send Feedback</button>
                    </div>
                    
                    <div class="button-group" style="text-align: center; margin-top: var(--spacing-xl);">
                        <button class="btn" onclick="showEmailModal()">Email my full results</button>
                        <button class="btn btn-secondary" onclick="startOver()">Take again</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Email Modal -->
    <div class="modal" id="emailModal" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
        <div class="modal-content">
            <button class="close-modal" onclick="closeEmailModal()" aria-label="Close modal">&times;</button>
            <h2 id="modalTitle">Get your full results</h2>
            <p>Enter your details to receive an analysis of your mortality type and subscale scores.</p>
            
            <div class="form-group">
                <label for="firstName">First name</label>
                <input type="text" id="firstName" placeholder="Enter your first name" required>
            </div>
            
            <div class="form-group">
                <label for="email">Email address</label>
                <input type="email" id="email" placeholder="Enter your email" required>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="emailConsent" checked>
                <label for="emailConsent">
                    I agree to receive occasional updates about mortality research and the Mortals community. I can unsubscribe at any time.
                </label>
            </div>
            
            <p style="font-size: 0.85rem; color: var(--gray-medium); text-align: left; margin-top: var(--spacing-md); line-height: 1.4;">
                Your data will be used for research purposes and to send you your results. We take your privacy seriously and will never sell or share your personal information with third parties.
            </p>
            
            <button class="btn" id="sendEmailBtn" onclick="sendEmail()">Send results</button>
            
            <div class="success-message" id="successMessage">
                Results sent successfully! Check your email.
            </div>
        </div>
    </div>

    <!-- Status Message -->
    <div class="status-message" id="statusMessage" role="status" aria-live="polite"></div>

    <!-- Brand Footer -->
    <div class="brand-footer">
        <div class="logo">
            <img src="mortals-logo.png" 
                 alt="Mortals logo" 
                 onerror="this.style.display='none'"
                 loading="lazy">
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container" id="progressContainer" role="progressbar" aria-valuemin="0" aria-valuemax="100">
        <div class="progress-text" id="progressText">Question 1 of 36</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>
    
    <script>
        'use strict';
        
        // MMAMM Core Logic
        const MMAMM = {
            questions: [
                { id: 1, text: "It makes me angry when I think about my own death", subscale: "FEAR" },
                { id: 2, text: "I have seen someone that almost died and it made me realise that I am very scared of dying", subscale: "FEAR" },
                { id: 3, text: "I am aware that death is part of life", subscale: "ACC" },
                { id: 4, text: "I think of death as something that is far away and that will not happen to me", subscale: "Diseng" },
                { id: 5, text: "I want to be remembered for doing great things for the world when I am no longer alive", subscale: "LEG" },
                { id: 6, text: "My values are very important to me because this is all that will be remembered from me when I will be dead", subscale: "LEG" },
                { id: 7, text: "We will all die at some point", subscale: "ACC" },
                { id: 8, text: "I only think of the present moment and do not worry about my own death", subscale: "Diseng" },
                { id: 9, text: "If I had an untreatable illness I would not fight it as we are helpless anyway", subscale: "Disemp" },
                { id: 10, text: "I would like to create something that will outlive me", subscale: "LEG" },
                { id: 11, text: "I want to do things in an original way so I am valued and feel further away from death", subscale: "LEG" },
                { id: 12, text: "Leaving behind my thoughts and beliefs in writing to others is a good way of beating death", subscale: "LEG" },
                { id: 13, text: "Nothing matters to me because we all die in the end", subscale: "Disemp" },
                { id: 14, text: "I am scared of dying before I am old", subscale: "FEAR" },
                { id: 15, text: "Life is futile", subscale: "Disemp" },
                { id: 16, text: "When I think about the fact that we are only on earth for a short period of time, I feel that I want to create something to leave behind", subscale: "LEG" },
                { id: 17, text: "I fear the death of my close relatives", subscale: "FEAR" },
                { id: 18, text: "I sometimes forget that I will die", subscale: "Diseng" },
                { id: 19, text: "Death makes me feel hopeless", subscale: "Disemp" },
                { id: 20, text: "I do not let the fear of dying rule my life", subscale: "ACC" },
                { id: 21, text: "I want to be remembered after my death for my charity work", subscale: "LEG" },
                { id: 22, text: "The idea of death makes me feel powerless", subscale: "FEAR" },
                { id: 23, text: "I would like to name a charity after my name so it lives on after my death", subscale: "LEG" },
                { id: 24, text: "I think of death as a negative thing", subscale: "FEAR" },
                { id: 25, text: "I accept that there is a cycle of life from birth to death", subscale: "ACC" },
                { id: 26, text: "I never think about what might happen after death", subscale: "Diseng" },
                { id: 27, text: "Thinking about death paralyses me", subscale: "FEAR" },
                { id: 28, text: "When I think about death, it makes me feel that human race is insignificant", subscale: "Disemp" },
                { id: 29, text: "When I think about death, I feel nervous", subscale: "FEAR" },
                { id: 30, text: "By giving time and energy to others unselfishly, I feel stronger than the forces that will end my days", subscale: "LEG" },
                { id: 31, text: "I feel afraid when I think of the time flying rapidly by", subscale: "FEAR" },
                { id: 32, text: "A record of my life (photo film, diaries) after I am no more is important for me so that I am remembered", subscale: "LEG" },
                { id: 33, text: "When thoughts of death enter my mind, I think about something else straight away", subscale: "FEAR" },
                { id: 34, text: "Thinking about death makes me feel that everything is pointless", subscale: "Disemp" },
                { id: 35, text: "I accept that I cannot live forever", subscale: "ACC" },
                { id: 36, text: "Death thoughts are an unnecessary waste of energy", subscale: "Diseng" }
            ],
            
            subscales: {
                LEG: { 
                    name: "Legacy", 
                    items: [5, 10, 11, 16, 21, 23, 30, 6, 32, 12],
                    description: "The need to create a legacy to live on beyond death"
                },
                FEAR: { 
                    name: "Fearfulness", 
                    items: [29, 14, 24, 27, 2, 31, 22, 17, 33, 1],
                    description: "Anxiety attached to the impossibility of escaping the end of one's life"
                },
                ACC: { 
                    name: "Acceptance", 
                    items: [3, 35, 20, 25, 7],
                    description: "Integration of the emotional and physical reality of death"
                },
                Disemp: { 
                    name: "Disempowerment", 
                    items: [34, 9, 13, 15, 19, 28],
                    description: "Realization of personal insignificance and vulnerability in the face of death"
                },
                Diseng: { 
                    name: "Disengagement", 
                    items: [8, 36, 26, 18, 4],
                    description: "Refusal to acknowledge death and a feeling of immortality"
                }
            },
            
            referenceData: {
                LEG: { mean: 4.08, std: 1.22 },
                FEAR: { mean: 3.64, std: 1.09 },
                ACC: { mean: 6.16, std: 0.94 },
                Disemp: { mean: 2.61, std: 1.14 },
                Diseng: { mean: 3.67, std: 1.15 }
            },
            
            archetypes: {
                "The Fearful Visionary": {
                    subscales: ["LEG", "FEAR"],
                    correlation: 0.399,
                    description: "This attitude type is focused on leaving a legacy but is held back by fear and anxiety. You have a vision for the future but struggle to take action to make it a reality."
                },
                "The Legacy Dreamer": {
                    subscales: ["LEG", "Disemp"],
                    correlation: 0.164,
                    description: "This attitude type is focused on leaving a legacy but feels disempowered to take action. You may struggle with feelings of hopelessness or self-doubt but are creative thinkers who can imagine a better future."
                },
                "The Mortality Denier": {
                    subscales: ["FEAR", "ACC"],
                    correlation: -0.267,
                    description: "This attitude type experiences inner conflict between fear and acceptance of mortality. You may oscillate between moments of acceptance and periods of anxiety, creating an ambivalent relationship with life's finite nature."
                },
                "The Mortality Shadow": {
                    subscales: ["FEAR", "Disemp"],
                    correlation: 0.381,
                    description: "This attitude type is consumed by fear and feels powerless to change their situation. You may struggle with depression or other mental health issues and may feel like you are living in a shadow."
                },
                "The Mortality Drifter": {
                    subscales: ["FEAR", "Diseng"],
                    correlation: 0.208,
                    description: "This attitude type is disengaged from thinking about death and experiences fear when they do. Your fear of death makes you feel disconnected from others and prevents you from pursuing their goals, but you may have a creative side that is waiting to be expressed."
                },
                "The Mortality Champion": {
                    subscales: ["ACC", "Disemp"],
                    correlation: -0.238,
                    description: "This attitude type demonstrates resilience in the face of mortality. Despite moments of feeling powerless, you maintain acceptance of life's finite nature, using this acceptance as a source of strength and empowerment."
                },
                "The Legacy Weaver": {
                    subscales: ["LEG", "Diseng"],
                    correlation: 0.039,
                    description: "This attitude type is focused on weaving a lasting legacy that will outlast them. You are engaged in the present and use your time and resources to create something that will make a positive impact on the world."
                }
            },
            
            scoring: {
                calculateRawScores(responses) {
                    const scores = {};
                    
                    for (const [subscaleKey, subscaleData] of Object.entries(MMAMM.subscales)) {
                        const itemScores = subscaleData.items.map(itemNum => responses[itemNum - 1]);
                        scores[subscaleKey] = itemScores.reduce((sum, score) => sum + score, 0) / itemScores.length;
                    }
                    
                    return scores;
                },
                
                standardizeScores(rawScores) {
                    const standardized = {};
                    
                    for (const [subscale, score] of Object.entries(rawScores)) {
                        const { mean, std } = MMAMM.referenceData[subscale];
                        standardized[subscale] = (score - mean) / std;
                    }
                    
                    return standardized;
                },
                
                assignArchetype(standardizedScores) {
                    let bestMatch = null;
                    let bestScore = -Infinity;
                    
                    for (const [archetypeName, archetypeData] of Object.entries(MMAMM.archetypes)) {
                        const [subscale1, subscale2] = archetypeData.subscales;
                        const score1 = standardizedScores[subscale1];
                        const score2 = standardizedScores[subscale2];
                        const correlation = archetypeData.correlation;
                        
                        let matchScore = 0;
                        
                        if (correlation > 0) {
                            matchScore = (score1 + score2) / 2;
                            const similarity = 1 - Math.abs(score1 - score2);
                            matchScore += similarity * Math.abs(correlation);
                        } else {
                            if (Math.abs(score1) < 0.5 && Math.abs(score2) < 0.5) {
                                matchScore = 1 - Math.abs(score1 - score2);
                            } else {
                                matchScore = Math.abs(score1 - score2) * Math.abs(correlation);
                            }
                        }
                        
                        if (matchScore > bestScore) {
                            bestScore = matchScore;
                            bestMatch = {
                                name: archetypeName,
                                description: archetypeData.description,
                                score: matchScore,
                                subscales: [subscale1, subscale2],
                                subscaleScores: [score1, score2]
                            };
                        }
                    }
                    
                    return bestMatch;
                },
                
                processResponses(responses) {
                    const rawScores = this.calculateRawScores(responses);
                    const standardizedScores = this.standardizeScores(rawScores);
                    const archetype = this.assignArchetype(standardizedScores);
                   
                   return {
                       rawScores,
                       standardizedScores,
                       archetype
                   };
               }
           }
       };
       
       // Application State
       let appState = {
           currentScreen: 'landing',
           currentQuestion: 0,
           responses: [],
           demographics: {},
           deathExperiences: {
               illness: null,
               closeIllness: null,
               closeIllnessLevel: null,
               closeDying: null,
               closeDyingLevel: null,
               seenDie: null
           },
           selectedOption: null,
           results: null,
           sessionId: null,
           feedbackSubmitted: false
       };
       
       // Utility Functions
       function generateSessionId() {
           return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
       }
       
       function showStatus(message, duration = 3000) {
           const statusEl = document.getElementById('statusMessage');
           if (!statusEl) return;
           
           statusEl.textContent = message;
           statusEl.classList.add('show');
           
           setTimeout(() => {
               statusEl.classList.remove('show');
           }, duration);
       }
       
       function debounce(func, wait) {
           let timeout;
           return function executedFunction(...args) {
               const later = () => {
                   clearTimeout(timeout);
                   func(...args);
               };
               clearTimeout(timeout);
               timeout = setTimeout(later, wait);
           };
       }
       
       // Screen Navigation
       function showScreen(screenName) {
           const targetScreen = screenName.endsWith('Screen') ? screenName : screenName + 'Screen';
           
           const screens = document.querySelectorAll('.screen');
           screens.forEach(screen => {
               screen.classList.remove('active', 'exit');
           });
           
           setTimeout(() => {
               const targetElement = document.getElementById(targetScreen);
               if (targetElement) {
                   targetElement.classList.add('active');
                   // Update ARIA
                   targetElement.setAttribute('aria-hidden', 'false');
                   screens.forEach(screen => {
                       if (screen !== targetElement) {
                           screen.setAttribute('aria-hidden', 'true');
                       }
                   });
               } else {
                   console.error('Screen not found:', targetScreen);
               }
           }, 100);
           
           appState.currentScreen = screenName.replace('Screen', '');
       }
       
       // Start Assessment
       function startAssessment() {
           appState = {
               currentScreen: 'intro1',
               currentQuestion: 0,
               responses: [],
               demographics: {},
               deathExperiences: {
                   illness: null,
                   closeIllness: null,
                   closeIllnessLevel: null,
                   closeDying: null,
                   closeDyingLevel: null,
                   seenDie: null
               },
               selectedOption: null,
               results: null,
               sessionId: generateSessionId(),
               feedbackSubmitted: false
           };
           showScreen('intro1Screen');
       }
       
       // Demographics Functions
       function checkDemographics() {
           const age = document.getElementById('ageRange').value;
           const sex = document.getElementById('sex').value;
           const nextBtn = document.getElementById('demographicsNext');
           
           if (age && sex) {
               nextBtn.disabled = false;
               nextBtn.classList.add('enabled');
               appState.demographics = { age, sex };
           } else {
               nextBtn.disabled = true;
               nextBtn.classList.remove('enabled');
           }
       }
       
       function proceedFromDemographics() {
           if (!appState.demographics.age || !appState.demographics.sex) {
               showStatus('Please complete all fields');
               return;
           }
           showScreen('deathExperience');
       }

       // Death Experience Functions
       function setDeathExperience(question, value) {
           appState.deathExperiences[question] = value;
           
           // Update button states
           const yesBtn = document.getElementById(`${question}-yes`);
           const noBtn = document.getElementById(`${question}-no`);
           
           if (yesBtn && noBtn) {
               yesBtn.classList.toggle('selected', value === true);
               noBtn.classList.toggle('selected', value === false);
           }
           
           // Show/hide follow-up scales
           if (question === 'closeIllness') {
               const scaleEl = document.getElementById('closeIllnessScale');
               if (scaleEl) {
                   scaleEl.style.display = value ? 'block' : 'none';
                   if (!value) {
                       appState.deathExperiences.closeIllnessLevel = null;
                       document.querySelectorAll('#closeIllnessScale .likert-option').forEach(btn => {
                           btn.classList.remove('selected');
                       });
                   }
               }
           }
           
           if (question === 'closeDying') {
               const scaleEl = document.getElementById('closeDyingScale');
               if (scaleEl) {
                   scaleEl.style.display = value ? 'block' : 'none';
                   if (!value) {
                       appState.deathExperiences.closeDyingLevel = null;
                       document.querySelectorAll('#closeDyingScale .likert-option').forEach(btn => {
                           btn.classList.remove('selected');
                       });
                   }
               }
           }
           
           checkDeathExperienceCompletion();
       }

       function setDeathExperienceScale(scale, value) {
           appState.deathExperiences[scale] = value;
           
           const container = scale === 'closeIllnessLevel' ? 'closeIllnessScale' : 'closeDyingScale';
           document.querySelectorAll(`#${container} .likert-option`).forEach(btn => {
               btn.classList.remove('selected');
           });
           
           const selectedBtn = document.querySelector(`#${container} .likert-option:nth-child(${value})`);
           if (selectedBtn) {
               selectedBtn.classList.add('selected');
           }
           
           checkDeathExperienceCompletion();
       }

       function checkDeathExperienceCompletion() {
           const de = appState.deathExperiences;
           let isComplete = true;
           
           if (de.illness === null || de.closeIllness === null || de.closeDying === null || de.seenDie === null) {
               isComplete = false;
           }
           
           if (de.closeIllness === true && de.closeIllnessLevel === null) {
               isComplete = false;
           }
           if (de.closeDying === true && de.closeDyingLevel === null) {
               isComplete = false;
           }
           
           const nextBtn = document.getElementById('deathExperienceNext');
           if (nextBtn) {
               nextBtn.disabled = !isComplete;
               nextBtn.classList.toggle('enabled', isComplete);
           }
       }
       
       // Start Questions
       function startQuestions() {
           const de = appState.deathExperiences;
           if (de.illness === null || de.closeIllness === null || de.closeDying === null || de.seenDie === null) {
               showStatus('Please answer all questions');
               return;
           }
           
           appState.currentQuestion = 0;
           appState.responses = [];
           appState.selectedOption = null;
           
           showScreen('question');
           const progressContainer = document.getElementById('progressContainer');
           if (progressContainer) {
               progressContainer.classList.add('show');
           }
           displayQuestion();
       }
       
       // Display Current Question
       function displayQuestion() {
           const question = MMAMM.questions[appState.currentQuestion];
           const questionText = document.getElementById('questionText');
           if (questionText) {
               questionText.textContent = question.text;
           }
           
           const progress = ((appState.currentQuestion + 1) / MMAMM.questions.length) * 100;
           const progressText = document.getElementById('progressText');
           const progressFill = document.getElementById('progressFill');
           const progressContainer = document.getElementById('progressContainer');
           
           if (progressText) {
               progressText.textContent = `Question ${appState.currentQuestion + 1} of ${MMAMM.questions.length}`;
           }
           if (progressFill) {
               progressFill.style.width = progress + '%';
           }
           if (progressContainer) {
               progressContainer.setAttribute('aria-valuenow', Math.round(progress));
           }
           
           document.querySelectorAll('.likert-option').forEach(opt => {
               opt.classList.remove('selected');
           });
           
           if (appState.responses[appState.currentQuestion]) {
               const prevValue = appState.responses[appState.currentQuestion];
               const prevOption = document.querySelector(`[data-value="${prevValue}"]`);
               if (prevOption) {
                   prevOption.classList.add('selected');
                   appState.selectedOption = prevValue;
               }
           } else {
               appState.selectedOption = null;
           }
       }
       
       // Select Option
       function selectOption(value) {
           document.querySelectorAll('.likert-option').forEach(opt => {
               opt.classList.remove('selected');
           });
           
           const selectedOption = document.querySelector(`[data-value="${value}"]`);
           if (selectedOption) {
               selectedOption.classList.add('selected');
           }
           
           appState.selectedOption = value;
           appState.responses[appState.currentQuestion] = value;
           
           setTimeout(() => {
               nextQuestion();
           }, 300);
       }
       
       // Next Question
       function nextQuestion() {
           const questionSlide = document.getElementById('questionSlide');
           
           if (appState.currentQuestion < MMAMM.questions.length - 1) {
               if (questionSlide) {
                   questionSlide.classList.remove('active');
                   questionSlide.classList.add('exit-up');
               }
               
               setTimeout(() => {
                   appState.currentQuestion++;
                   displayQuestion();
                   
                   if (questionSlide) {
                       questionSlide.classList.remove('exit-up');
                       questionSlide.classList.add('active');
                   }
               }, 500);
           } else {
               calculateResults();
           }
       }
       
       // Firebase Functions
       async function saveToFirebase(data) {
           try {
               if (!window.firebaseDB || !window.firebaseInitialized) {
                   console.warn('Firebase not available - data not saved');
                   return false;
               }
               
               const responsesRef = window.firebaseRef(window.firebaseDB, 'responses');
               await window.firebasePush(responsesRef, data);
               console.log('Data saved to Firebase successfully');
               return true;
           } catch (error) {
               console.error('Error saving to Firebase:', error);
               return false;
           }
       }
       
       // Score Interpretation
       function getScoreInterpretation(subscale, rawScore) {
           const mean = MMAMM.referenceData[subscale].mean;
           const std = MMAMM.referenceData[subscale].std;
           const zScore = (rawScore - mean) / std;
           
           const isGoodWhenHigh = (subscale === 'LEG' || subscale === 'ACC');
           
           let emoji, label, description, colorClass;
           
           if (isGoodWhenHigh) {
               if (zScore > 1) {
                   emoji = '🤩';
                   label = subscale === 'LEG' ? 'Deeply Legacy-Focused' : 'Deeply Integrated';
                   description = subscale === 'LEG' ? 'Strong drive to create lasting impact' : 'Profound emotional integration of mortality';
                   colorClass = 'score-high';
               } else if (zScore > 0.5) {
                   emoji = '🤩';
                   label = subscale === 'LEG' ? 'Legacy-Driven' : 'Well-Integrated';
                   description = subscale === 'LEG' ? 'Clear focus on leaving something behind' : 'Good emotional processing of life\'s finite nature';
                   colorClass = 'score-high';
               } else if (zScore > -0.5) {
                   emoji = '☺️';
                   label = subscale === 'LEG' ? 'Moderately Legacy-Minded' : 'Moderately Processed';
                   description = subscale === 'LEG' ? 'Some interest in lasting impact' : 'Some emotional integration of mortality';
                   colorClass = 'score-good';
               } else if (zScore > -1) {
                   emoji = '😕';
                   label = subscale === 'LEG' ? 'Minimally Legacy-Focused' : 'Struggling to Process';
                   description = subscale === 'LEG' ? 'Limited drive for lasting impact' : 'Difficulty emotionally integrating mortality';
                   colorClass = 'score-moderate';
               } else {
                   emoji = '😔';
                   label = subscale === 'LEG' ? 'No Legacy Drive' : 'Emotionally Unprocessed';
                   description = subscale === 'LEG' ? 'Little interest in creating lasting impact' : 'Significant difficulty processing mortality reality';
                   colorClass = 'score-problem';
               }
           } else {
               if (zScore < -1) {
                   emoji = '🤩';
                   if (subscale === 'FEAR') {
                       label = 'Exceptionally Calm';
                       description = 'Very low death-related anxiety';
                   } else if (subscale === 'Disemp') {
                       label = 'Feels Empowered';
                       description = 'Doesn\'t feel powerless against mortality';
                   } else {
                       label = 'Mortality-Engaged';
                       description = 'Actively engages with mortality thoughts';
                   }
                   colorClass = 'score-high';
               } else if (zScore < -0.5) {
                   emoji = '☺️';
                   if (subscale === 'FEAR') {
                       label = 'Well-Managed Fear';
                       description = 'Low levels of death anxiety';
                   } else if (subscale === 'Disemp') {
                       label = 'Generally Empowered';
                       description = 'Low feelings of helplessness about death';
                   } else {
                       label = 'Generally Engaged';
                       description = 'Comfortable thinking about mortality';
                   }
                   colorClass = 'score-good';
               } else if (zScore < 0.5) {
                   emoji = '😕';
                   if (subscale === 'FEAR') {
                       label = 'Moderate Fear Levels';
                       description = 'Typical death-related concerns';
                   } else if (subscale === 'Disemp') {
                       label = 'Mixed Feelings';
                       description = 'Sometimes feels powerless about mortality';
                   } else {
                       label = 'Sometimes Avoidant';
                       description = 'Occasional avoidance of death thoughts';
                   }
                   colorClass = 'score-moderate';
               } else if (zScore < 1) {
                   emoji = '😔';
                   if (subscale === 'FEAR') {
                       label = 'Elevated Anxiety';
                       description = 'High levels of death-related fear';
                   } else if (subscale === 'Disemp') {
                       label = 'Often Feels Powerless';
                       description = 'Frequent feelings of helplessness against death';
                   } else {
                       label = 'Actively Avoidant';
                       description = 'Frequently avoids mortality awareness';
                   }
                   colorClass = 'score-problem';
               } else {
                   emoji = '😔';
                   if (subscale === 'FEAR') {
                       label = 'Intense Death Anxiety';
                       description = 'Very high fear and distress';
                   } else if (subscale === 'Disemp') {
                       label = 'Deeply Powerless';
                       description = 'Overwhelming sense of vulnerability and helplessness';
                   } else {
                       label = 'Completely Withdrawn';
                       description = 'Persistent withdrawal from mortality thoughts';
                   }
                   colorClass = 'score-problem';
               }
           }
           
           return { emoji, label, description, colorClass };
       }
       
       // Calculate Results
       async function calculateResults() {
           const results = MMAMM.scoring.processResponses(appState.responses);
           appState.results = results;
           
           console.log('Assessment Complete!', results);
           
           const dataToStore = {
               sessionId: appState.sessionId,
               timestamp: new Date().toISOString(),
               demographics: appState.demographics,
               deathExperiences: appState.deathExperiences,
               responses: appState.responses,
               rawScores: results.rawScores,
               standardizedScores: results.standardizedScores,
               archetype: results.archetype.name,
               completedAt: new Date().toISOString()
           };
           
           const saved = await saveToFirebase(dataToStore);
           
           if (saved) {
               showStatus('Results saved successfully!');
           }
           
           // Display results
           document.getElementById('archetypeName').textContent = results.archetype.name;
           document.getElementById('archetypeDescription').textContent = results.archetype.description;
           
           // Set archetype image
           const imageMap = {
               'The Fearful Visionary': 'fearful-visionary.png',
               'The Legacy Dreamer': 'legacy-dreamer.png',
               'The Mortality Denier': 'mortality-denier.png',
               'The Mortality Shadow': 'mortality-shadow.png',
               'The Mortality Drifter': 'mortality-drifter.png',
               'The Mortality Champion': 'mortality-champion.png',
               'The Legacy Weaver': 'legacy-weaver.png'
           };

           const archetypeImage = document.getElementById('archetypeImage');
           const imagePath = imageMap[results.archetype.name];
           if (imagePath && archetypeImage) {
               archetypeImage.src = imagePath;
               archetypeImage.alt = `${results.archetype.name} illustration`;
           }
           
           createModernScoreDisplay(results.rawScores);
           
           showScreen('results');
           const progressContainer = document.getElementById('progressContainer');
           if (progressContainer) {
               progressContainer.classList.remove('show');
           }
       }
       
       // Create Score Display
       function createModernScoreDisplay(rawScores) {
           const scoresContainer = document.getElementById('scoresContainer');
           if (!scoresContainer) return;
           
           const subscaleOrder = ['LEG', 'FEAR', 'ACC', 'Disemp', 'Diseng'];
           
           let scoreRowsHtml = '';
           
           subscaleOrder.forEach(key => {
               const score = rawScores[key];
               const subscale = MMAMM.subscales[key];
               const interpretation = getScoreInterpretation(key, score);
               
               scoreRowsHtml += `
                   <div class="score-row" role="listitem">
                       <div class="score-category">${subscale.name}</div>
                       <div class="score-emoji" aria-hidden="true">${interpretation.emoji}</div>
                       <div class="score-status">
                           <div class="score-label">${interpretation.label}</div>
                           <div class="score-description">${interpretation.description}</div>
                       </div>
                       <div class="score-value ${interpretation.colorClass}" aria-label="Score: ${score.toFixed(1)} out of 7">
                           ${score.toFixed(1)}/7
                       </div>
                   </div>
               `;
           });
           
           scoresContainer.innerHTML = scoreRowsHtml;
       }
       
       // Feedback Functions
       async function submitFeedback(feedbackType, buttonElement) {
           if (appState.feedbackSubmitted) {
               showStatus('Thank you! You\'ve already submitted feedback.');
               return;
           }
           
           try {
               const feedbackData = {
                   feedbackType: feedbackType,
                   sessionId: appState.sessionId,
                   archetype: appState.results?.archetype?.name || 'Unknown',
                   timestamp: new Date().toISOString()
               };
               
               if (window.firebaseDB && window.firebaseInitialized) {
                   const feedbackRef = window.firebaseRef(window.firebaseDB, 'feedback');
                   await window.firebasePush(feedbackRef, feedbackData);
               }
               
               appState.feedbackSubmitted = true;
               
               // Visual feedback
               showStatus('Thank you for your feedback!');
               
               // Update button states
               document.querySelectorAll('.feedback-btn').forEach(btn => {
                   btn.disabled = true;
                   btn.style.opacity = '0.5';
               });
               
               if (buttonElement) {
                   buttonElement.classList.add('selected');
                   buttonElement.style.opacity = '1';
               }
               
           } catch (error) {
               console.error('Error saving feedback:', error);
               showStatus('Thank you for your feedback!');
           }
       }
       
       async function submitDetailedFeedback() {
           const feedbackText = document.getElementById('additionalFeedback').value.trim();
           
           if (!feedbackText) {
               showStatus('Please enter some feedback first');
               return;
           }
           
           try {
               const detailedFeedbackData = {
                   feedback: feedbackText,
                   sessionId: appState.sessionId,
                   archetype: appState.results?.archetype?.name || 'Unknown',
                   timestamp: new Date().toISOString()
               };
               
               if (window.firebaseDB && window.firebaseInitialized) {
                   const detailedFeedbackRef = window.firebaseRef(window.firebaseDB, 'detailed_feedback');
                   await window.firebasePush(detailedFeedbackRef, detailedFeedbackData);
               }
               
               // Clear and disable
               const textArea = document.getElementById('additionalFeedback');
               textArea.value = '';
               textArea.placeholder = 'Thank you for your feedback!';
               textArea.disabled = true;
               
               const sendBtn = event.target;
               if (sendBtn) {
                   sendBtn.disabled = true;
                   sendBtn.textContent = 'Feedback Sent!';
               }
               
               showStatus('Thank you for your detailed feedback!');
               
           } catch (error) {
               console.error('Error saving detailed feedback:', error);
               showStatus('Thank you for your feedback!');
           }
       }
       
       // Email Functions
       function showEmailModal() {
           const modal = document.getElementById('emailModal');
           if (modal) {
               modal.classList.add('show');
               // Focus management for accessibility
               const firstInput = document.getElementById('firstName');
               if (firstInput) {
                   setTimeout(() => firstInput.focus(), 100);
               }
           }
       }
       
       function closeEmailModal() {
           const modal = document.getElementById('emailModal');
           if (modal) {
               modal.classList.remove('show');
           }
           document.getElementById('successMessage').classList.remove('show');
           document.getElementById('firstName').value = '';
           document.getElementById('email').value = '';
       }
       
       function getPersonalizedInsight(subscale, rawScore) {
           const mean = MMAMM.referenceData[subscale].mean;
           const std = MMAMM.referenceData[subscale].std;
           const zScore = (rawScore - mean) / std;
           
           if (subscale === 'LEG') {
               if (zScore > 0.5) {
                   return "Your strong legacy drive suggests you find deep meaning in creating something that will outlast you. Consider channeling this energy into concrete projects.";
               } else if (zScore < -0.5) {
                   return "You're less focused on traditional legacy, which can be liberating. You might find more meaning in present-moment experiences.";
               } else {
                   return "Your balanced approach to legacy allows you to appreciate both present experiences and future impact.";
               }
           } else if (subscale === 'FEAR') {
               if (zScore < -0.5) {
                   return "Your low death anxiety allows you to engage with life more fully and make important decisions without significant distress.";
               } else if (zScore > 0.5) {
                   return "Your heightened mortality awareness creates anxiety. Consider exploring what specific aspects concern you most.";
               } else {
                   return "You experience typical levels of death-related concern. This natural anxiety can be a motivator without being overwhelming.";
               }
           } else if (subscale === 'ACC') {
               if (zScore > 0.5) {
                   return "Your acceptance of mortality is a profound strength, allowing you to make decisions from wisdom rather than fear.";
               } else if (zScore < -0.5) {
                   return "You're still processing the reality of mortality. Acceptance often develops through life experience and reflection.";
               } else {
                   return "You're integrating mortality into your worldview. This ongoing journey can deepen your appreciation for life.";
               }
           } else if (subscale === 'Disemp') {
               if (zScore < -0.5) {
                   return "You maintain a sense of agency despite mortality's inevitability, allowing you to take meaningful action.";
               } else if (zScore > 0.5) {
                   return "Remember that while death is inevitable, how you live is entirely in your control. Small actions can restore your sense of power.";
               } else {
                   return "You sometimes struggle with feelings of powerlessness. Finding areas where you have control can help balance these feelings.";
               }
           } else if (subscale === 'Diseng') {
               if (zScore < -0.5) {
                   return "You actively engage with thoughts about mortality. This engagement often leads to more intentional living.";
               } else if (zScore > 0.5) {
                   return "You tend to avoid thinking about death. Gradual engagement with mortality often leads to greater life satisfaction.";
               } else {
                   return "You have a moderate level of engagement with mortality thoughts, allowing you to function without obsessing.";
               }
           }
       }
       
       async function sendEmail() {
           const firstName = document.getElementById('firstName').value.trim();
           const email = document.getElementById('email').value.trim();
           const emailConsent = document.getElementById('emailConsent').checked;
           const sendBtn = document.getElementById('sendEmailBtn');
           
           // Validation
           if (!firstName || !email) {
               showStatus('Please fill in all fields');
               return;
           }
           
           const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
           if (!emailRegex.test(email)) {
               showStatus('Please enter a valid email address');
               return;
           }
           
           // Initialize EmailJS if needed
           if (window.emailjs && !window.emailjsInitialized) {
               try {
                   emailjs.init("FpS7IboHIPBgSaspa");
                   window.emailjsInitialized = true;
               } catch (error) {
                   console.error('EmailJS init error:', error);
               }
           }
           
           if (!window.emailjs) {
               showStatus('Email service unavailable. Please try again later.');
               return;
           }
           
           // Disable button
           sendBtn.disabled = true;
           sendBtn.innerHTML = '<span class="loading"></span> Sending...';
           
           // Save email data to Firebase
           if (window.firebaseDB && window.firebaseInitialized && appState.sessionId) {
               try {
                   const emailDataRef = window.firebaseRef(window.firebaseDB, `email_data/${appState.sessionId}`);
                   await window.firebaseSet(emailDataRef, {
                       sessionId: appState.sessionId,
                       firstName: firstName,
                       email: email,
                       emailConsent: emailConsent,
                       emailedAt: new Date().toISOString()
                   });
               } catch (error) {
                   console.error('Error saving email data:', error);
               }
           }
           
           // Prepare template parameters
           const templateParams = {
               to_email: email,
               user_name: firstName,
               archetype_name: appState.results.archetype.name,
               archetype_description: appState.results.archetype.description,
               
               leg_score: appState.results.rawScores.LEG.toFixed(1),
               fear_score: appState.results.rawScores.FEAR.toFixed(1),
               acc_score: appState.results.rawScores.ACC.toFixed(1),
               disemp_score: appState.results.rawScores.Disemp.toFixed(1),
               diseng_score: appState.results.rawScores.Diseng.toFixed(1),
               
               leg_emoji: getScoreInterpretation('LEG', appState.results.rawScores.LEG).emoji,
               leg_label: getScoreInterpretation('LEG', appState.results.rawScores.LEG).label,
               leg_description: getScoreInterpretation('LEG', appState.results.rawScores.LEG).description,
               leg_insight: getPersonalizedInsight('LEG', appState.results.rawScores.LEG),
               
               fear_emoji: getScoreInterpretation('FEAR', appState.results.rawScores.FEAR).emoji,
               fear_label: getScoreInterpretation('FEAR', appState.results.rawScores.FEAR).label,
               fear_description: getScoreInterpretation('FEAR', appState.results.rawScores.FEAR).description,
               fear_insight: getPersonalizedInsight('FEAR', appState.results.rawScores.FEAR),
               
               acc_emoji: getScoreInterpretation('ACC', appState.results.rawScores.ACC).emoji,
               acc_label: getScoreInterpretation('ACC', appState.results.rawScores.ACC).label,
               acc_description: getScoreInterpretation('ACC', appState.results.rawScores.ACC).description,
               acc_insight: getPersonalizedInsight('ACC', appState.results.rawScores.ACC),
               
               disemp_emoji: getScoreInterpretation('Disemp', appState.results.rawScores.Disemp).emoji,
               disemp_label: getScoreInterpretation('Disemp', appState.results.rawScores.Disemp).label,
               disemp_description: getScoreInterpretation('Disemp', appState.results.rawScores.Disemp).description,
               disemp_insight: getPersonalizedInsight('Disemp', appState.results.rawScores.Disemp),
               
               diseng_emoji: getScoreInterpretation('Diseng', appState.results.rawScores.Diseng).emoji,
               diseng_label: getScoreInterpretation('Diseng', appState.results.rawScores.Diseng).label,
               diseng_description: getScoreInterpretation('Diseng', appState.results.rawScores.Diseng).description,
               diseng_insight: getPersonalizedInsight('Diseng', appState.results.rawScores.Diseng)
           };
           
           try {
               const response = await emailjs.send('service_cym10iv', 'template_zj4e18l', templateParams);
               console.log('Email sent successfully:', response);
               
               document.getElementById('successMessage').classList.add('show');
               
               setTimeout(() => {
                   sendBtn.disabled = false;
                   sendBtn.innerHTML = 'Send Results';
               }, 2000);
               
           } catch (error) {
               console.error('Email error:', error);
               showStatus('Sorry, there was an error sending your results. Please try again.');
               sendBtn.disabled = false;
               sendBtn.innerHTML = 'Send Results';
           }
       }
       
       function startOver() {
           if (confirm('Are you sure you want to start over? Your current results will be lost.')) {
               location.reload();
           }
       }
       
       // Initialize
       window.addEventListener('DOMContentLoaded', () => {
           // Check Firebase
           setTimeout(() => {
               if (window.firebaseInitialized) {
                   console.log('Firebase initialized successfully');
               } else {
                   console.warn('Firebase not available - running in offline mode');
               }
           }, 2000);
           
           // Add keyboard navigation
           document.addEventListener('keydown', (e) => {
               if (appState.currentScreen === 'question' && e.key >= '1' && e.key <= '7') {
                   selectOption(parseInt(e.key));
               }
           });
           
           // Handle modal close on escape
           document.addEventListener('keydown', (e) => {
               if (e.key === 'Escape') {
                   const modal = document.getElementById('emailModal');
                   if (modal && modal.classList.contains('show')) {
                       closeEmailModal();
                   }
               }
           });
           
           // Close modal on background click
           const modal = document.getElementById('emailModal');
           if (modal) {
               modal.addEventListener('click', (e) => {
                   if (e.target === modal) {
                       closeEmailModal();
                   }
               });
           }
       });
   </script>
</body>
</html>
